/*!
 * Consistent.js 0.12.4
 * @author Karl von Randow
 * @license Apache License, Version 2.0
 */
(function(e,t){"use strict";var n=e.document;var r=e.Consistent=function(e){if(arguments.length===0){return r.createScope()}if(typeof e==="string"){return r.findScope(e)}if(e.nodeName!==t){return r.findScopeForNode(e)}var n;var i;var s;var o=0;if(r.isScope(e)){n=e;o++}if(typeof arguments[o]==="object"){i=arguments[o];o++}if(typeof arguments[o]==="function"){s=arguments[o];o++}if(arguments[o]!==t){throw M("Unexpected argument to Consistent(): "+e)}return r.createScope(n,i,s)};var i={};var s={};var o="ConsistentScope";var a=function(){var e={};var t=n.createElement("div");t.setAttribute("className","test");e.badGetSetAttribute=t.className==="test";e.needChangeEventForActiveOnSubmit=e.needAggressiveChangeHandlingOnInputElements=!!n.createEventObject;return e}();p(r,{settings:{attributes:{key:["data-ct","ct"],show:["data-ct-show","ct-show"],hide:["data-ct-hide","ct-hide"],enabled:["data-ct-enabled","ct-enabled"],disabled:["data-ct-disabled","ct-disabled"],readOnly:["data-ct-readonly","ct-readonly"],readWrite:["data-ct-readwrite","ct-readwrite"],options:["data-ct-options","ct-options"],template:["data-ct-tmpl","ct-tmpl"],templateId:["data-ct-tmpl-id","ct-tmpl-id"],attributes:["data-ct-attrs","ct-attrs"],attributePrefix:["data-ct-attr-","ct-attr-"],properties:["data-ct-props","ct-props"],propertyPrefix:["data-ct-prop-","ct-prop-"],templateAttributePrefix:["data-ct-tmpl-attr-","ct-tmpl-attr-"],templateIdAttributePrefix:["data-ct-tmpl-id-attr-","ct-tmpl-id-attr-"],classAttribute:["data-ct-class","ct-class"],classAddAttribute:["data-ct-add-class","ct-add-class"],on:["data-ct-do","ct-do"],onPrefix:["data-ct-on-","ct-on-"],repeat:["data-ct-repeat","ct-repeat"],repeatContainerId:["data-ct-repeat-container-id","ct-repeat-container-id"],noBind:["data-ct-nobind","ct-nobind"],scope:["data-ct-scope","ct-scope"],init:["data-ct-init","ct-init"],initFunc:["data-ct-init-func","ct-init-func"],controller:["data-ct-controller","ct-controller"],warningPrefix:["data-ct-","ct-"]},scopeIdKey:"__ConsistentScopeID",functionIdKey:"__ConsistentFunctionID",oldDisplayKey:"__ConsistentOldDisplay",addedClassesKey:"__ConsistentAddedClasses",maxWatcherLoops:100,autoCreateScopes:true},isScope:function(e){return e!==t&&e.$!==t&&e.$._type===o},createScope:function(e,t,n){t=d({},r.defaultOptions,t);var o=new V(e,t);i[o._id]=o;if(o._name){s[o._name]=o}var a=o._scope;if(n){if(typeof n==="function"){o.replaceController(new n(a))}else{throw M("Invalid argument type for controller: "+typeof n)}}return a},autoCreateScopes:function(){var t=n;var i=r.settings.attributes.scope;var s=r.settings.attributes.controller;var o=r.settings.attributes.init;var a=r.settings.attributes.initFunc;var l=i.length;var f=s.length;var u=o.length;var c=a.length;p(t);function p(t){var n,d;var h;if(t.hasAttribute){for(h=0;h<l;h++){if(t.hasAttribute(i[h])){n=t.getAttribute(i[h]);break}}for(h=0;h<f;h++){if(t.hasAttribute(s[h])){d=t.getAttribute(s[h]);break}}}if(typeof n==="string"||d){var v;if(d){v=b(e,d);if(!v){throw M("Cannot find controller class: "+d)}}var g=r.createScope(null,n?{name:n}:null,v);g.$.bind(t);var y;for(h=0;h<u;h++){y=t.getAttribute(o[h]);if(y){break}}var m;for(h=0;h<c;h++){var _=t.getAttribute(a[h]);if(_){m=b(e,_);if(typeof m!=="function"){throw M("Consistent scope init function attribute referenced a function that was not found: "+_)}break}}if(!y){if(!m&&!v){g.$.update()}if(m){m.call(g)}g.$.apply()}else if(y==="update"){g.$.update();if(m){m.call(g)}g.$.apply()}else if(y==="none"){if(m){m.call(g)}}else if(y){var $=r.statementToFunction(y);A($,g);if(m){m.call(g)}g.$.apply()}}else{var w=t.firstChild;while(w!==null){if(w.nodeType===1){p(w)}w=w.nextSibling}}}},destroyScope:function(e){var t=e.$._manager();t.destroy();delete i[t._id];if(t._name){delete s[t._name]}},findScope:function(e){var t=s[e];if(t){return t._scope}else{return null}},findScopeForNode:function(e){var t=e[r.settings.scopeIdKey];if(t&&i[t]){return i[t]._scope}else{return null}},expressionToFunction:function(e){throw M("Expression support requires consistent-expressions.js")},statementToFunction:function(e){throw M("Expression support requires consistent-expressions.js")},merge:p});var l={};function f(e){return l.toString.call(e)==="[object Array]"}function u(e){for(var t in e){return false}return true}var c;if(typeof[].indexOf==="function"){c=function(e,t,n){return e.indexOf(t,n)}}else{c=function(e,n,r){if(r===t){r=0}if(r<0){r+=e.length;if(r<0){r=0}}for(var i=r;i<e.length;i++){if(e[i]===n){return i}}return-1}}r.arrayIndexOf=c;function p(){var e=[];var n=[];function r(){var i=0;var s=false;if(typeof arguments[0]==="boolean"){s=arguments[0];i++}var o=arguments[i];if(typeof o!=="object"&&typeof o!=="function"){throw M("Target object argument to merge is not appropriate: "+typeof o)}if(o===null){throw M("Target object argument to merge is not appropriate: "+o)}for(var a=i+1;a<arguments.length;a++){var l=arguments[a];if(l===t){continue}if(typeof l!=="object"&&typeof l!=="function"){throw M("Argument "+(a+1)+" to merge is not appropriate: "+typeof l)}e.push(l);n.push(o);for(var u in l){var p=l[u];if(p!==t){if(s&&typeof p==="object"&&p!==null){var d=c(e,p);if(d===-1){var h=o[u];if(h===t){h=f(p)?[]:{}}p=r(true,h,p)}else{p=n[d]}}o[u]=p}}}return o}return r.apply(null,arguments)}function d(){var e=[];for(var t=0;t<arguments.length;t++){var n=arguments[t];if(n){e.push(arguments[t].$)}}if(!e[0]){e[0]={}}var r=p.apply(null,arguments);r.$=p.apply(null,e);return r}function h(e){if(!a.badGetSetAttribute){return e}if(e==="class"){return"className"}else{return e}}function v(e){return e.replace(/\.([0-9]+)(\.|$)/g,"[$1]$2")}function g(e){var t=[];for(var n=0;n<e.length;n++){t.push(v(e[n]))}return t}function y(e){return e.replace(/\[([0-9]+)\]/g,".$1")}function b(e,n){var r=n.split(".");var i=e;var s;for(s=0;s<r.length&&i!==t&&i!==null;s++){if(r[s]==="constructor"){throw M("Illegal attempt to access 'constructor' keyword for property: "+n)}if(i&&i.constructor===i){throw M("Illegal attempt to access Function constructor for property: "+n)}i=i[r[s]]}if(s===r.length){if(i&&i.constructor===i){throw M("Illegal attempt to access Function constructor for property: "+n)}return i}else{return t}}function m(e,n){if(n===t){n=""}var r=[];for(var i in e){if(typeof e[i]==="object"&&e[i]!==null){r=r.concat(m(e[i],n+i+"."))}else{r.push(n+i)}}return r}function _(e,n,r){var i=n.split(".");var s=e;for(var o=0;o<i.length-1;o++){if(s[i[o]]===t){s[i[o]]={}}s=s[i[o]]}s[i[i.length-1]]=r}function $(e){var t=e.value;if(t===null){t=e.text}return t}function w(e,t){return e({get:function(e){return b(t,e)}})}function A(e,t){return e({get:function(e){return t.$.get(e)},set:function(e,n){return t.$.set(e,n)}})}r.defaultOptions={templateEngine:null,autoListenToChange:true,autoListenToKeyEvents:true,eventHandlerPrefix:"",valueFunctionPrefix:"",$:{getNodeOptions:function(e,t){return r.getNodeOptions(e,t)},apply:function(e,n,r){var i,s,o;var a=r.bindings;if(a.selectOptions){s=b(n,a.selectOptions);if(s!==t){if(!s){s=[]}var l=e.selectedIndex!==-1?$(e.options[e.selectedIndex]):t;e.length=s.length;for(o=0;o<s.length;o++){var u;if(typeof s[o]==="object"){var c=s[o].text;var p=s[o].value;u=new Option(c!==t?c:"",p!==t?p:"",false,p==l);if(s[o].label!==t){u.label=s[o].label}if(s[o].disabled!==t){u.disabled=!!s[o].disabled}}else{u=new Option(s[o],s[o],false,s[o]==l)}e.options[o]=u}}}if(a.key){s=y(a.key);if(s!==t){this.setValue(e,s)}}else if(a.template!==t&&a.template!==null){this.setValue(e,a.template.render(n))}if(a.attributes){var d=a.attributes;for(o=0;o<d.length;o++){if(d[o].key!==t){s=y(d[o].key)}else if(d[o].template!==t){s=d[o].template.render(n)}else{s=null}if(s!==t){this.setAttributeValue(e,d[o].name,s)}}}if(a.allAttributes){s=b(n,a.allAttributes);for(i in s){if(s[i]!==t){s=s[i];if(i==="className"){i="class"}this.setAttributeValue(e,i,s)}}}if(a.classAttribute){s=y(a.classAttribute);if(s!==t){if(f(s)){s=s.join(" ")}this.setAttributeValue(e,"class",s)}}if(a.classAddAttribute){s=y(a.classAddAttribute);if(s!==t){this.addRemoveClasses(e,s)}}if(a.properties){var h=a.properties;for(o=0;o<h.length;o++){s=y(h[o].key);if(s!==t){this.setPropertyValue(e,h[o].name,s)}}}if(a.allProperties){s=b(n,a.allProperties);var v=m(s);for(o=0;o<v.length;o++){var g=b(s,v[o]);if(g!==t){this.setPropertyValue(e,v[o],g)}}}if(a.show){s=y(a.show);if(s!==t){if(s){this.show(e)}else{this.hide(e)}}}if(a.hide){s=y(a.hide);if(s!==t){if(!s){this.show(e)}else{this.hide(e)}}}if(a.enabled){s=y(a.enabled);if(s!==t){this.setPropertyValue(e,"disabled",!s)}}if(a.disabled){s=y(a.disabled);if(s!==t){this.setPropertyValue(e,"disabled",!!s)}}if(a.readOnly){s=y(a.readOnly);if(s!==t){this.setPropertyValue(e,"readOnly",!!s)}}if(a.readWrite){s=y(a.readWrite);if(s!==t){this.setPropertyValue(e,"readOnly",!s)}}function y(e){if(typeof e==="function"){return w(e,n)}else{return b(n,e)}}},afterApply:function(e,t){},setValue:function(e,t){var n=this.getValue(e);if(n===t){return}var r=e.nodeName;if(r==="INPUT"||r==="TEXTAREA"){if(e.type==="checkbox"){if(f(t)){e.checked=e.defaultChecked=c(t,e.value)!==-1}else if(typeof t==="boolean"){e.checked=e.defaultChecked=t}else{e.checked=e.defaultChecked=t==e.value}}else if(e.type==="radio"){e.checked=e.defaultChecked=t==e.value}else{if(t===null){t=""}e.value=t}}else if(r==="SELECT"){if(t===null){t=""}var i;if(f(t)){for(i=0;i<e.options.length;i++){e.options[i].selected=c(t,$(e.options[i]))!==-1}}else{for(i=0;i<e.options.length;i++){if($(e.options[i])==t){e.selectedIndex=i;return}}e.selectedIndex=-1}}else if(r==="IMG"){e.src=t}else{e.innerHTML=t}},setAttributeValue:function(e,t,n){t=h(t);if(n){e.setAttribute(t,n)}else{e.removeAttribute(t)}},setPropertyValue:function(e,t,n){_(e,t,n)},update:function(e,n,r){var i,s;var o=r.bindings;if(v(o.selectOptions)){var a=e.options;i=[];for(s=0;s<a.length;s++){var l=a[s];i.push({text:l.text,value:l.value,label:l.label,disabled:l.disabled})}n.$.set(o.selectOptions,i)}if(v(o.key)){i=this.getValue(e);if(i!==t){if(e.nodeName==="INPUT"&&e.type==="checkbox"){var u=n.$.get(o.key);if(f(u)){s=c(u,e.value);if(i){if(s===-1){u.push(e.value)}}else{if(s!==-1){u.splice(s,1)}}}else if(e.value!=="on"&&(u===t||u===null)){if(i){n.$.set(o.key,e.value)}}else if(typeof u==="boolean"||e.value==="on"){n.$.set(o.key,i)}else if(i&&u!==e.value){n.$.set(o.key,[u,e.value])}else if(!i&&u===e.value){n.$.set(o.key,t)}}else{n.$.set(o.key,i)}}}if(v(o.attributes)){var p=o.attributes;for(s=0;s<p.length;s++){if(p[s].key!==t){i=this.getAttributeValue(e,p[s].name);n.$.set(p[s].key,i)}}}if(v(o.allAttributes)){i=n.$.get(o.allAttributes);if(i!==t){for(s in i){i[s]=this.getAttributeValue(e,s)}n.$.set(o.allAttributes,i)}}if(v(o.classAttribute)){i=this.getAttributeValue(e,"class");if(f(n.$.get(o.classAttribute))){i=i.split(" ")}n.$.set(o.classAttribute,i)}if(v(o.properties)){var d=o.properties;for(s=0;s<d.length;s++){i=this.getPropertyValue(e,d[s].name);n.$.set(d[s].key,i)}}if(v(o.allProperties)){i=n.$.get(o.allProperties);if(i!==t){var h=m(i);for(s=0;s<h.length;s++){_(i,h[s],this.getPropertyValue(e,h[s]))}n.$.set(o.allProperties,i)}}if(v(o.show)){i=this.isShowing(e);n.$.set(o.show,i)}if(v(o.hide)){i=this.isShowing(e);n.$.set(o.hide,!i)}if(v(o.enabled)){i=this.getPropertyValue(e,"disabled");n.$.set(o.enabled,!i)}if(v(o.disabled)){i=this.getPropertyValue(e,"disabled");n.$.set(o.disabled,i)}if(v(o.readOnly)){i=this.getPropertyValue(e,"readOnly");n.$.set(o.readOnly,i)}if(v(o.readWrite)){i=this.getPropertyValue(e,"readOnly");n.$.set(o.readWrite,!i)}function v(e){return e&&typeof e!=="function"}},getValue:function(e){var n=e.nodeName;if(n==="INPUT"||n==="TEXTAREA"){if(e.type==="checkbox"){return e.checked}else if(e.type==="radio"){return e.checked?e.value:t}else{return e.value}}else if(n==="SELECT"){if(e.multiple){var r=[];for(var i=0;i<e.options.length;i++){if(e.options[i].selected){r.push($(e.options[i]))}}return r}else if(e.selectedIndex!==-1){return $(e.options[e.selectedIndex])}else{return t}}else if(n==="IMG"){return e.src}else{return e.innerHTML}},getAttributeValue:function(e,t){t=h(t);return e.getAttribute(t)},getPropertyValue:function(e,t){return b(e,t)},addRemoveClasses:function(e,t){var n=p(t);var i=p(this.getAttributeValue(e,"class"));var s=e[r.settings.addedClassesKey];if(!s){s=[];e[r.settings.addedClassesKey]=s}var o,a,l;for(o=0;o<s.length;o++){a=c(n,s[o]);if(a===-1){l=c(i,s[o]);if(l!==-1){i.splice(l,1)}s.splice(o,1);o--}}for(o=0;o<n.length;o++){var u=n[o];a=c(s,u);if(a===-1){l=c(i,u);if(l===-1){i.push(u);s.push(u)}}}this.setAttributeValue(e,"class",i.join(" "));function p(e){if(e===null||!e){return[]}else if(typeof e==="string"){return e.split(" ")}else if(f(e)){return e}else{throw M("Unsupported value for add class: "+typeof e)}}},show:function(e){if(e.style.display!=="none"){return}var n=e[r.settings.oldDisplayKey];if(n===t){n=""}e.style.display=n},hide:function(e){if(e.style.display==="none"){return}e[r.settings.oldDisplayKey]=e.style.display;e.style.display="none"},isShowing:function(e){return e.style.display!=="none"},added:function(e){},remove:function(e){e.parentNode.removeChild(e)}}};r.getNodeOptions=r.defaultGetNodeOptions=function(e,i){var s=d({bindings:{}},i);var o=s.bindings;var a=e.nodeName;if(a==="INPUT"||a==="TEXTAREA"||a==="SELECT"){if(o.key===t){o.key=e.getAttribute("name")}}var l=r.settings;var u=e.attributes;if(u===t){throw M("Unexpected object, expected DOM node: "+e)}for(var c=0;c<u.length;c++){var p=u[c].name;var h=g(p);if(h){var v=S(u[c].value);if(!v&&h.name!=="noBind"){continue}switch(h.name){case"key":{o.key=N(v);break}case"attributePrefix":{_(h.suffix,N(v));break}case"attributes":{o.allAttributes=v;break}case"template":{y();o.template=i.templateEngine.compile(v);break}case"templateId":{y();o.template=i.templateEngine.compile(b(v));break}case"templateAttributePrefix":{y();$(h.suffix,i.templateEngine.compile(v));break}case"templateIdAttributePrefix":{y();$(h.suffix,i.templateEngine.compile(b(v)));break}case"propertyPrefix":{w(h.suffix.replace(/-/g,"."),N(v));break}case"properties":{o.allProperties=v;break}case"on":{A(k(e),C(v));break}case"onPrefix":{A(h.suffix.toLowerCase(),C(v));break}case"show":{o.show=N(v);break}case"hide":{o.hide=N(v);break}case"repeat":{o.repeat=v;break}case"repeatContainerId":{o.repeatContainerId=v;break}case"enabled":{o.enabled=N(v);break}case"disabled":{o.disabled=N(v);break}case"readOnly":{o.readOnly=N(v);break}case"readWrite":{o.readWrite=N(v);break}case"options":{o.selectOptions=v;break}case"classAttribute":{o.classAttribute=N(v);break}case"classAddAttribute":{o.classAddAttribute=N(v);break}case"noBind":{o.noBind=!v||v==="true";break}case"scope":case"init":case"initFunc":case"controller":{break}case"warningPrefix":{if(typeof console!=="undefined"&&console.log!==t){console.log('Warning: Unrecognised Consistent attribute "'+p+'" on '+e.nodeName+" element.")}break}default:{throw M("Unhandled consistent declaration attribute: "+p)}}}}function g(e){for(var t in l.attributes){var n=l.attributes[t];var r;var i=t.lastIndexOf("Prefix");if(i!==-1&&i===t.length-"Prefix".length){if(f(n)){for(r=0;r<n.length;r++){if(e.indexOf(n[r])===0){return{name:t,suffix:e.substring(n[r].length)}}}}else if(e.indexOf(n)===0){return{name:t,suffix:e.substring(n.length)}}}else{if(f(n)){for(r=0;r<n.length;r++){if(e===n[r]){return{name:t}}}}else if(e===n){return{name:t}}}}return false}function y(){if(!i.templateEngine){throw M("templateEngine not configured in options")}}function b(e){var t=n.getElementById(e);if(t!==null){return t.innerHTML}else{throw M("Template not found with id: "+e)}}function m(){if(o.attributes===t){o.attributes=[]}}function _(e,t){m();o.attributes.push({name:e,key:t})}function $(e,t){m();o.attributes.push({name:e,template:t})}function w(e,n){if(o.properties===t){o.properties=[]}o.properties.push({name:e,key:n})}function A(e,n){if(o.events===t){o.events={}}if(o.events[e]===t){o.events[e]={keys:[]}}o.events[e].keys.push(n)}function k(e){var t=e.nodeName;if(t==="INPUT"||t==="TEXTAREA"||t==="SELECT"){return"change"}else if(t==="FORM"){return"submit"}else{return"click"}}function S(e){return e.replace(/^\s*(.*)\s*$/,"$1")}function x(e){return e.match(/^[a-zA-Z_$][a-zA-Z_$0-9\.]*$/)}function N(e){if(x(e)){return e}else{return r.expressionToFunction(e)}}function C(e){if(x(e)){return e}else{return r.statementToFunction(e)}}return s};function k(e,n,i,s){if(s===t){s=[]}if(c(s,e)!==-1){return true}s.push(e);var o=i.$.options();var a=o.valueFunctionPrefix;var l;var u=[];var p=0;for(var d in e){if(c(u,d)!==-1){continue}var h=e[d];if(typeof h==="function"){if(!a){e[d]=h.call(i,n)}else if(d.indexOf(a)===0){l=x(d,a);e[l]=h.call(i,n);delete e[d];if(l!==d){u.push(l)}}}else if(typeof h==="object"&&h!==null){if(r.isScope(h)){if(n===i){e[d]=h.$.snapshot()}else{delete e[d];p++}}else{var v=k(h,n,i,s);if(!v){delete e[d]}}}}if(p>0&&f(e)&&p===e.length){return false}return true}r.defaultEmptyScope={$:{_type:o,_scope:null,_controller:null,_manager:null,index:t,apply:function(e,n,r){if(typeof e==="function"){if(typeof n==="boolean"){r=n;n=t}n=e;e=t}else if(typeof e==="boolean"){r=e;e=t}else if(typeof n==="boolean"){r=n;n=t}var i=this._scope();if(n!==t){n.call(i,e,r)}this._manager().apply(e,r);return i},applyLater:function(n,r,i){if(typeof n==="function"){if(typeof r==="boolean"){i=r;r=t}r=n;n=t}else if(typeof n==="boolean"){i=n;n=t}else if(typeof r==="boolean"){i=r;r=t}var s=this._scope();if(r!==t){r.call(s,n,i)}e.clearTimeout(this._applyLaterTimeout);this._applyLaterTimeout=e.setTimeout(function(){s.$.apply(n,i)},0);return s},needsApply:function(){return this._manager().needsApply()},update:function(e,t){this._manager().update(e,t);return this._scope()},bind:function(e,t){this._manager().bind(e,t);return this._scope()},unbind:function(e){this._manager().unbind(e);return this._scope()},merge:function(e,n){var r=this._scope();var i;if(typeof e==="boolean"){i=p(e,{},n);delete i.$;return p(e,r,i)}else if(n===t){i=p({},e);delete i.$;return p(r,i)}else if(f(n)){for(var s=0;s<n.length;s++){_(r,n[s],b(e,n[s]))}return r}else if(typeof n!=="object"){_(r,n,b(e,n));return r}else{throw M("Invalid keys argument to merge: "+n)}},clear:function(){var e=this._scope();for(var t in e){if(t!=="$"){delete e[t]}}},scope:function(e){if(e===t){return this._scope()}else if(typeof e==="object"){return this._manager().replaceScope(e)}else{throw M("Invalid argument type to scope(newScope): "+typeof e)}},controller:function(e){if(e===t){return this._controller()}else if(typeof e==="object"){this._manager().replaceController(e);return this._scope()}else if(typeof e==="string"){var n=S(e,this.options().eventHandlerPrefix);var r=arguments[1];if(typeof r==="function"){_(this._controller(),n,r);return this._scope()}else{var i=true;if(typeof r==="boolean"){i=r}else if(r!==t){throw M("Invalid argument type for get or set controller function: "+typeof func)}var s=this._controller();var o=b(s,n);if(o!==t){if(typeof o==="function"){return function(){return o.apply(s,arguments)}}else{return o}}else if(i&&this.parent()){return this.parent().$.controller(e)}else{return t}}}else{throw M("Invalid argument type for controller(): "+typeof newController)}},snapshot:function(e,n){if(e!==t&&typeof e!=="boolean"){throw M("Invalid argument type for includeParents: "+typeof e)}var r=this._scope();var i=p(true,{},r);delete i.$;k(i,n!==t?n:r,r);if(e!==false&&this.parent()){i=p(this.parent().$.snapshot(e,n!==t?n:r),i)}return i},nodes:function(e){if(e!==t&&typeof e!=="boolean"){throw M("Invalid argument type for includeParents: "+typeof e)}var n=this._manager()._domNodes;if(e!==false){var r=this.children();for(var i=0;i<r.length;i++){n=n.concat(r[i].$.nodes())}}return n},roots:function(){return this._manager()._rootDomNodes},parent:function(){var e=this._manager()._parentScopeManager;if(e!==null){return e._scope}else{return null}},children:function(){var e=[];var t=this._manager()._childScopeManagers;for(var n=0;n<t.length;n++){e.push(t[n]._scope)}return e},watch:function(e,t){this._manager().watch(e,t);return this._scope()},unwatch:function(e,t){this._manager().unwatch(e,t);return this._scope()},get:function(e,n,r){if(n!==t&&typeof n!=="boolean"){throw M("Invalid argument type for includeParents: "+typeof n)}if(e==="$"||e.substring(0,2)==="$."){return t}var i=this.options().valueFunctionPrefix;var s=this._scope();var o=y(e);var a=b(s,o);if(a!==t){if(!i&&typeof a==="function"){return a.call(s,r!==t?r:s)}else{return a}}else{var l;if(i){l=S(o,i);a=b(s,l);if(typeof a==="function"){return a.call(s,s)}}}if(n!==false&&this.parent()){return this.parent().$.get(e,n,r!==t?r:s)}else{return t}},set:function(e,n){var r=this._scope();var i=b(r,e);if(typeof i==="undefined"){var s=this.getValueFunction(e);if(s!==t){s.call(null,r,n);return r}}if(typeof i!=="function"){_(r,e,n)}else if(!this.options().valueFunctionPrefix){i.call(r,r,n)}else{_(r,e,n)}return r},fire:function(e){var n=this.controller(e);var r=this._scope();if(n!==t){var i=[r].concat(Array.prototype.slice.call(arguments,1));return n.apply(null,i)}else{return t}},getValueFunction:function(e,n){if(n!==t&&typeof n!=="boolean"){throw M("Invalid argument type for includeParents: "+typeof n)}var r=this._scope();var i=this.options().valueFunctionPrefix;if(i&&b(r,e)!==t){return t}var s=b(r,S(e,i));if(s!==t){if(typeof s==="function"){return function(){return s.apply(r,arguments)}}else{return t}}else if(n!==false&&this.parent()){return this.parent().$.getValueFunction(e)}else{return t}},setValueFunction:function(e,t){e=S(e,this.options().valueFunctionPrefix);var n=this._scope();_(n,e,t);return n},options:function(e){return this._manager().getOptions(e)},evaluate:function(e){var t=r.expressionToFunction(e);var n=this.snapshot();return w(t,n)},exec:function(e){var t=r.statementToFunction(e);return A(t,this._scope())}}};function S(e,t){if(!t){return e}var n=e.split(".");var r="";for(var i=0;i<n.length-1;i++){r+=n[i]+"."}var s=n[n.length-1];if(N(t)){r+=t+s.substring(0,1).toUpperCase()+s.substring(1)}else{r+=t+s}return r}function x(e,n){if(n===t){return e}if(N(n)){var r=e.substring(n.length);return r.substring(0,1).toLowerCase()+r.substring(1)}else{return e.substring(n.length)}}function N(e){if(!e){return false}var t=e.charAt(e.length-1);return t>="A"&&t<="Z"||t>="a"&&t<="z"}function C(e,n,r,i,s,o){if(r===t){r=""}if(i===t){i=0}if(s===t){s=[]}if(o===t){o=[]}if(c(o,e)!==-1||c(o,n)!==-1){return s}o.push(e);o.push(n);if(e===n){return s}var a;if(n!==null){for(a in e){if(e[a]!==n[a]){if(typeof e[a]==="object"&&typeof n[a]==="object"&&e[a]&&n[a]){C(e[a],n[a],r+a+".",i+1,s,o)}else{s.push(r+a)}}}}else{for(a in e){s.push(r+a)}}for(a in n){if(e===null||e[a]===t){s.push(r+a)}}return s}function E(e,t){var n=typeof e;if(n!==typeof t){return false}if(n==="function"){return e===t}else if(n==="object"){var r=C(e,t);return r.length===0}else{return true}}function I(e,t){for(var n=0;n<t.length;n++){e.removeAttribute(t[n])}}V.prototype={};var P=0;var T=0;var O="$all";function V(e,t){this._id="ConsistentScope"+P;P++;if(t.name){this._name=t.name}if(e){this._parentScopeManager=e.$._manager();this._parentScopeManager._childScopeManagers.push(this)}else{this._parentScopeManager=null}this._childScopeManagers=[];this._options=t;this._nodes=[];this._domNodes=[];this._repeatNodes=[];this._rootDomNodes=[];this._watchers={};this._nodesDirty=false;this._applying=false;this._repeatNodeScope=false;this._scope=d({},r.defaultEmptyScope);this._controller={$:this._scope.$};var n=this;this._scope.$._manager=function(){return n};this._scope.$._scope=function(){return n._scope};this._scope.$._controller=function(){return n._controller};this._cleanScopeSnapshot=this._scope.$.snapshot()}V.prototype.apply=function(e,n){if(this._applying){return}this._applying=true;var r,i;if(this._updateCleanScopeAndFireWatchers()||this._nodesDirty){i=this._nodes.length;var s;for(r=0;r<i;r++){var o=this._nodes[r];s=e!==t?d({},o.options,e):o.options;s.$.apply(o.dom,this._cleanScopeSnapshot,s)}i=this._repeatNodes.length;for(r=0;r<i;r++){var a=this._repeatNodes[r];s=e!==t?d({},a.options,e):a.options;this._handleRepeat(a,s,this._cleanScopeSnapshot)}if(n!==false){var l=this._scope.$.children();for(r=0,i=l.length;r<i;r++){var f=l[r];if(f.$._manager()._repeatNodeScope){continue}f.$.apply(true)}}this._nodesDirty=false;if(this._parentScopeManager){this._parentScopeManager._scope.$.apply(e)}var u=e!==t?d({},this._options,e):this._options;u.$.afterApply(this._scope,this._cleanScopeSnapshot)}this._applying=false};V.prototype._handleRepeat=function(e,i,s){var o=i.bindings.repeat;var a;var l=this._scope.$.get(o);var f=b(s,o);if(f===t){return}if(typeof f!=="object"){throw M('Repeat for key "'+o+'" is not an object in the scope, found '+typeof f)}e.version++;var u=e.version;var c=e.insertBefore;var p=c.parentNode;var d=null;var h;var v=n.activeElement;var g=false;for(a=l.length-1;a>=0;a--){var y=l[a];h=S(y);var m=false;if(h===t){var _=x();var $=r(this._scope,this._options);$.$._manager()._repeatNodeScope=true;$.$.bind(_);$=$.$.scope(y);h={object:y,domNodes:_,scope:$,version:u};e.items.push(h);m=true}else{h.version=u}var w=h.domNodes[h.domNodes.length-1];if(m||w.nextSibling!==c){N(h.domNodes,c,p)}if(m){for(var A=0;A<h.domNodes.length;A++){i.$.added(h.domNodes[A])}}h.before=c;d=c=h.domNodes[0];h.scope.$.index=a;h.scope.$.apply()}var k=[];for(a=e.items.length-1;a>=0;a--){h=e.items[a];if(h.version!==u){N(h.domNodes,h.before,p);h.scope.$.unbind(h.domNodes);k=k.concat(h.domNodes);e.items.splice(a,1);h.scope.$.index=t}}if(k.length){for(a=k.length-1;a>=0;a--){i.$.remove(k[a])}}if(g&&v){v.focus()}function S(n){var r=e.items.length;for(var i=0;i<r;i++){var s=e.items[i];if(s.object===n){return s}}return t}function x(){var t=[];var n=e.domNodes.length;for(var r=0;r<n;r++){t.push(e.domNodes[r].cloneNode(true))}return t}function N(e,t,n){var r=e.length;for(var i=0;i<r;i++){var s=e[i];n.insertBefore(s,t);if(s===v){g=true}}}};V.prototype.update=function(e,n){var r,i,s;if(e===t){i=this._nodes.length;for(r=0;r<i;r++){s=this._nodes[r];s.options.$.update(s.dom,this._scope,s.options)}}else{if(f(e)||D(e)){i=e.length;for(r=0;r<i;r++){this.update(e[r],n)}}else{r=c(this._domNodes,e);if(r!==-1){s=this._nodes[r];s.options.$.update(s.dom,this._scope,s.options)}if(n){var o=e.firstChild;while(o!==null){if(o.nodeType===1){this.update(o,n)}o=o.nextSibling}}}}};V.prototype.needsApply=function(){if(this._nodesDirty){return true}return this.isDirty()};V.prototype.isDirty=function(){return C(this._scope.$.snapshot(),this._cleanScopeSnapshot).length!==0};V.prototype._updateCleanScopeAndFireWatchers=function(){var e=false;var t;var n=true;var i=0;var s=this._cleanScopeSnapshot;var o={};while(n){var a=this._scope.$.snapshot();t=[];while(n){n=false;if(i>=r.settings.maxWatcherLoops){throw M("Too many loops while notifying watchers. There is likely to be an infinite loop caused by watcher functions continously changing the scope. You may otherwise increase Consistent.settings.maxWatcherLoops if this is not the case.")}var l=C(a,s);l=p(l);for(var f=0;f<l.length;f++){var u=l[f];if(c(t,u)===-1){t.push(u)}n|=this._notifyWatchers(u,b(a,u),b(s,u),this._scope,o)}i++}if(t.length>0){n|=this._notifyWatchAlls(t,this._scope,a,s,o);e=true}s=a}if(e){this._cleanScopeSnapshot=this._scope.$.snapshot();return true}else{return false}function p(e){var t=[].concat(e);for(var n=0;n<e.length;n++){var r=e[n];while(true){var i=r.lastIndexOf(".");if(i!==-1){r=r.substring(0,i);if(c(t,r)===-1){t.push(r)}else{break}}else{break}}}return t}};V.prototype._notifyWatchers=function(e,n,i,s,o){var a=false;var l=this._watchers[e];if(l!==t){for(var f=0;f<l.length;f++){var u=o[e];if(u===t){o[e]=u={}}var c=l[f];var p=c[r.settings.functionIdKey];if(p===t){p=c[r.settings.functionIdKey]="ConsistentFunction"+T;T++}if(u[p]===t||!E(u[p].cleanValue,n)){c.call(this._scope,s,v(e),n,i);u[p]={cleanValue:b(s.$.snapshot(),e)};a=true}}}if(this._parentScopeManager){a|=this._parentScopeManager._notifyWatchers(e,n,i,s,o)}return a};V.prototype._notifyWatchAlls=function(e,n,i,s,o){var a=false;var l=this._watchers[O];if(l!==t){for(var f=0;f<l.length;f++){var u=o[O];if(u===t){o[O]=u={}}var c=l[f];var p=c[r.settings.functionIdKey];if(p===t){p=c[r.settings.functionIdKey]="ConsistentFunction"+T;T++}if(u[p]===t||!E(i,u[p].cleanScopeSnapshot)){l[f].call(this._scope,n,g(e),i,s);u[p]={cleanScopeSnapshot:n.$.snapshot()};a=true}}}if(this._parentScopeManager){a|=this._parentScopeManager._notifyWatchAlls(e,n,i,s,o)}return a};function F(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}else{throw M("Unable to attach event to DOM node. Cannot find supported method.")}}function L(e){if(!e.preventDefault){e.preventDefault=function(){this.returnValue=false}}}function j(e,t){var r;if(n.createEvent){r=n.createEvent("HTMLEvents");r.initEvent(t,true,true);e.dispatchEvent(r)}else if(n.createEventObject){e.fireEvent("on"+t)}else{throw M("Unable to fire a DOM event. Cannot find supported method.")}return r}function D(e){return e.length!==t&&e.attributes===t}V.prototype.bind=function(e,i,s){var o;if(f(e)||D(e)){for(o=0;o<e.length;o++){this.bind(e[o],i,s)}return}var l;if(e[r.settings.scopeIdKey]!==this._id){l=d({},this._options,i);l=l.$.getNodeOptions(e,l);if(l.bindings.noBind){return}e[r.settings.scopeIdKey]=this._id;if(s===t){this._rootDomNodes.push(e)}if(!u(l.bindings)){if(l.bindings.repeat!==t){var c={version:0,items:[],options:l};var p=l.bindings.repeat;if(l.bindings.repeatContainerId){var h=n.getElementById(l.bindings.repeatContainerId);if(h!==null){c.domNodes=h.children}else{throw M("Couldn't find element with id \""+l.bindings.repeatContainerId+'" for repeat container.')}}else{c.domNodes=[e.cloneNode(true)]}for(o=0;o<c.domNodes.length;o++){I(c.domNodes[o],r.settings.attributes.repeat);I(c.domNodes[o],r.settings.attributes.repeatContainerId)}var v=n.createComment("Consistent repeat "+p);e.parentNode.insertBefore(v,e);e.parentNode.removeChild(e);v[r.settings.scopeIdKey]=this._id;c.insertBefore=n.createComment("/Consistent repeat "+p);v.parentNode.insertBefore(c.insertBefore,v.nextSibling);this._repeatNodes.push(c);this._nodesDirty=true}else{this._nodes.push({dom:e,options:l});this._domNodes.push(e);this._nodesDirty=true;var g=this;var y=e.nodeName;var b;if(l.autoListenToChange&&(y==="INPUT"||y==="TEXTAREA"||y==="SELECT")){b=function(t){L(t);l.$.update(e,g._scope,l);g._nodesDirty=true;g._scope.$.apply()};F(e,"change",b,false);if(a.needAggressiveChangeHandlingOnInputElements&&(y==="INPUT"&&(e.type==="checkbox"||e.type==="radio"))){F(e,"click",b,false)}l.$._changeListener=b}if(l.autoListenToKeyEvents&&(y==="INPUT"||y==="TEXTAREA")){b=function(t){L(t);l.$.update(e,g._scope,l);g._nodesDirty=true;g._scope.$.apply()};F(e,"keyup",b,false);l.$._keyListener=b}for(var m in l.bindings.events){(function(r,i){var s=function(s){var o;L(s);if(a.needChangeEventForActiveOnSubmit&&r==="submit"&&e.nodeName==="FORM"){for(o=0;o<e.elements.length;o++){if(n.activeElement===e.elements[o]){j(e.elements[o],"change")}}}for(o=0;o<i.length;o++){var l=i[o];var f;var u;if(typeof l==="function"){u=A(l,g._scope);if(typeof u!=="function"){s.preventDefault();g._scope.$.apply();continue}else{f=u}}if(f===t){f=g._scope.$.controller(l)}if(f!==t){if(f){u=f(g._scope,s,e);if(u===false)break}}else{s.preventDefault();var c=g._options.eventHandlerPrefix;throw M('Bound "'+r+'" event cannot find an event handler function in "'+S(l,c)+'"')}}};l.bindings.events[r].listener=s;F(e,r,s)})(m,l.bindings.events[m].keys)}}}}if(l===t||!l.bindings.repeat){var _=e.firstChild;while(_!==null){if(_.nodeType===1){this.bind(_,i,e)}_=_.nextSibling}}};V.prototype.unbind=function(e){var n;if(f(e)||D(e)){for(n=0;n<e.length;n++){this.unbind(e[n])}return}n=c(this._domNodes,e);if(n!==-1){var r=this._nodes[n];var i=r.options;for(var s in i.bindings.events){e.removeEventListener(s,i.bindings.events[s].listener,false)}if(i.$._changeListener!==t){e.removeEventListener("change",i.$._changeListener,false)}if(i.$._keyListener!==t){e.removeEventListener("keyup",i.$._keyListener,false);
}this._domNodes.splice(n,1);this._nodes.splice(n,1)}var o=e.firstChild;while(o!==null){if(o.nodeType===1){this.unbind(o)}o=o.nextSibling}};V.prototype.watch=function(e,n){if(typeof e==="function"&&n===t){n=e;e=O}else{e=y(e)}var r=this._watchers[e];if(r===t){r=[];this._watchers[e]=r}r.push(n)};V.prototype.unwatch=function(e,n){if(typeof e==="function"&&n===t){n=e;e=O}else{e=y(e)}var r=this._watchers[e];if(r!==t){var i=c(r,n);r.splice(i,1)}};V.prototype.getOptions=function(e){if(e===t){return this._options}for(var n=0;n<this._nodes.length;n++){if(this._nodes[n].dom===e){return this._nodes[n].options}}return null};V.prototype.replaceScope=function(e){e.$=this._scope.$;this._scope=e;return e};V.prototype.replaceController=function(e){e.$=this._scope.$;this._controller=e};V.prototype.destroy=function(){this.unbind(this._rootDomNodes)};function M(e){return new W(e)}W.prototype={};function W(e){this.name="ConsistentException";this.message=e}W.prototype.toString=function(){return"Consistent.js exception: "+this.message}})(window);
//# sourceMappingURL=consistent.min.js.map