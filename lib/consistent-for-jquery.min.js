/*! 
 * Consistent.js 0.2.0
 * @author Karl von Randow
 * @license Apache License, Version 2.0
 */
!function(e,t){var n=e.Consistent=function(){var e=arguments[0];if(e!==t){if(n.isScope(e)){if(arguments[1]!==t){return n.createScope(e,arguments[1])}else{return n.createScope(e,null)}}else if(e.nodeName!==t){return n.findScopeForNode(e)}else if(typeof e=="object"){return n.createScope(null,e)}else{throw new b("Unexpected argument to Consistent(): "+e)}}else{return n.createScope(null,null)}};var i={};var r="ConsistentScope";var o=function(){var e={};var t=document.createElement("div");t.setAttribute("className","test");e.badGetSetAttribute=t.className==="test";return e}();p(n,{settings:{keyDataAttribute:"data-ct",showDataAttribute:"data-ct-show",hideDataAttribute:"data-ct-hide",templateDataAttribute:"data-ct-tmpl",templateIdDataAttribute:"data-ct-tmpl-id",attributeDataAttributePrefix:"data-ct-attr-",propertyDataAttributePrefix:"data-ct-prop-",templateAttributeDataAttributePrefix:"data-ct-tmpl-attr-",templateIdAttributeDataAttributePrefix:"data-ct-tmpl-id-attr-",bindDataAttribute:"data-ct-bind",bindDataAttributePrefix:"data-ct-bind-",repeatDataAttribute:"data-ct-rep",repeatContainerIdDataAttribute:"data-ct-rep-container-id",warningDataAttributePrefix:"data-ct-",scopeIdKey:"__ConsistentScopeID",functionIdKey:"__ConsistentFunctionID",oldDisplayKey:"__ConsistentOldDisplay",maxWatcherLoops:100},isScope:function(e){return e!==t&&e.$!==t&&e.$._type===r},createScope:function(e,t){t=f({},n.defaultOptions,t);var r=new _(e,t);i[r._id]=r._scope;return r._scope},findScopeForNode:function(e){var t=e[n.settings.scopeIdKey];if(t&&i[t]){return i[t]}else{return null}},merge:p});var s={};function a(e){return s.toString.call(e)==="[object Array]"}function p(){var e=0;var n=false;if(typeof arguments[0]==="boolean"){n=arguments[0];e++}var i=arguments[e];if(typeof i!=="object"&&typeof i!=="function"){throw new b("First object argument to merge is not appropriate: "+typeof i)}if(i===null){throw new b("First object argument to merge is not appropriate: "+i)}for(var r=e+1;r<arguments.length;r++){var o=arguments[r];if(o===t){continue}if(typeof o!=="object"&&typeof o!=="function"){throw new b("Argument "+(r+1)+" to merge is not appropriate: "+typeof o)}for(var s in o){if(s==="$"){continue}var f=o[s];if(f!==t){if(n&&typeof f==="object"&&f!==null){f=p(true,a(f)?[]:{},f)}i[s]=f}}}return i}function f(){var e=[];for(var t=0;t<arguments.length;t++){var n=arguments[t];if(n){e.push(arguments[t].$)}}if(!e[0]){e[0]={}}var i=p.apply(this,arguments);i.$=p.apply(this,e);return i}function u(e){if(!o.badGetSetAttribute){return e}if(e==="class"){return"className"}else{return e}}function l(e,n){var i=n.split(".");var r=e;var o;for(o=0;o<i.length&&r!==t&&r!==null;o++){r=r[i[o]]}if(o==i.length){return r}else{return t}}function c(e,n,i){var r=n.split(".");var o=e;for(var s=0;s<r.length-1;s++){if(o[r[s]]===t){o[r[s]]={}}o=o[r[s]]}o[r[r.length-1]]=i}n.defaultOptions={templateEngine:null,autoListenToChange:true,$:{getNodeOptions:function(e,t){return n.getNodeOptions(e,t)},apply:function(e,n,i){var r;if(i.key){r=l(n,i.key);if(r!==t){this.setValue(e,r)}}else if(i.template!==t&&i.template!==null){this.setValue(e,i.template.render(n))}var o;if(i.attributes){var s=i.attributes;for(o=0;o<s.length;o++){if(s[o].key!==t){r=l(n,s[o].key)}else if(s[o].template!==t){r=s[o].template.render(n)}else{r=null}if(r!==t){this.setAttributeValue(e,s[o].name,r)}}}if(i.properties){var a=i.properties;for(o=0;o<a.length;o++){r=l(n,a[o].key);if(r!==t){this.setPropertyValue(e,a[o].name,r)}}}if(i.show){r=l(n,i.show);if(r!==t){if(r){this.show(e)}else{this.hide(e)}}}else if(i.hide){r=l(n,i.hide);if(r!==t){if(!r){this.show(e)}else{this.hide(e)}}}},afterApply:function(e,t){},setValue:function(e,t){var n=e.nodeName;if(n==="INPUT"||n==="TEXTAREA"){if(e.type==="checkbox"){e.checked=t?true:false}else if(e.type==="radio"){e.checked=t==e.value}else{e.value=t}}else if(n==="SELECT"){if(t===null){t=""}for(var i=0;i<e.options.length;i++){if(e.options[i].value==t){e.selectedIndex=i;break}}}else if(n==="IMG"){e.src=t}else{e.innerHTML=t}},setAttributeValue:function(e,t,n){t=u(t);if(n){e.setAttribute(t,n)}else{e.removeAttribute(t)}},setPropertyValue:function(e,t,n){c(e,t,n)},update:function(e,n,i){var r,o;if(i.key){r=this.getValue(e);if(r!==t){n.$.set(i.key,r)}}if(i.attributes){var s=i.attributes;for(o=0;o<s.length;o++){if(s[o].key!==t){r=this.getAttributeValue(e,s[o].name);n.$.set(s[o].key,r)}}}if(i.properties){var a=i.properties;for(o=0;o<a.length;o++){r=this.getPropertyValue(e,a[o].name);n.$.set(a[o].key,r)}}},getValue:function(e){var n=e.nodeName;if(n==="INPUT"||n==="TEXTAREA"){if(e.type==="checkbox"){return e.checked}else if(e.type==="radio"){return e.checked?e.value:t}else{return e.value}}else if(n==="SELECT"){return e.options[e.selectedIndex].value}else if(n==="IMG"){return e.src}else{return e.innerHTML}},getAttributeValue:function(e,t){t=u(t);return e.getAttribute(t)},getPropertyValue:function(e,t){return l(e,t)},show:function(e){if(e.style.display!=="none"){return}var i=e[n.settings.oldDisplayKey];if(i===t){i=""}e.style.display=i},hide:function(e){if(e.style.display==="none"){return}e[n.settings.oldDisplayKey]=e.style.display;e.style.display="none"},added:function(e){},remove:function(e){e.parentNode.removeChild(e)}}};n.defaultOptions.$.$original=n.defaultOptions.$;n.getNodeOptions=n.defaultGetNodeOptions=function(e,i){var r=f({},i);var o=e.nodeName;if(o==="INPUT"||o==="TEXTAREA"||o==="SELECT"){if(r.key===t){r.key=e.getAttribute("name")}}var s=n.settings;var a=e.attributes;for(var p=0;p<a.length;p++){var u=a[p].name;var l=a[p].value;var c,h,d;if(u==s.keyDataAttribute){r.key=l}else if(u.indexOf(s.attributeDataAttributePrefix)===0){c=u.substring(s.attributeDataAttributePrefix.length);y(c,l)}else if(u==s.templateDataAttribute){v();r.template=i.templateEngine.compile(l)}else if(u==s.templateIdDataAttribute){v();r.template=i.templateEngine.compile(g(l))}else if(u.indexOf(s.templateAttributeDataAttributePrefix)===0){v();c=u.substring(s.templateAttributeDataAttributePrefix.length);_(c,i.templateEngine.compile(l))}else if(u.indexOf(s.templateIdAttributeDataAttributePrefix)===0){v();c=u.substring(s.templateIdAttributeDataAttributePrefix.length);_(c,i.templateEngine.compile(g(l)))}else if(u.indexOf(s.propertyDataAttributePrefix)===0){h=u.substring(s.propertyDataAttributePrefix.length);h=h.replace(/-/g,".");A(h,l)}else if(u===s.bindDataAttribute){d=$(e);w(d,l)}else if(u.indexOf(s.bindDataAttributePrefix)===0){d=u.substring(s.bindDataAttributePrefix.length).toLowerCase();w(d,l)}else if(u===s.showDataAttribute){r.show=l}else if(u===s.hideDataAttribute){r.hide=l}else if(u===s.repeatDataAttribute){r.repeat=l}else if(u===s.repeatContainerIdDataAttribute){r.repeatContainerId=l}else if(u.indexOf(s.warningDataAttributePrefix)===0){if(console.log!==t){console.log('Warning: Unrecognised Consistent attribute "'+u+'" on '+e.nodeName+" element.")}}}function v(){if(!i.templateEngine){throw new b("templateEngine not configured in options")}}function g(e){var t=document.getElementById(e);if(t!==null){return t.innerHTML}else{throw new b("Template not found with id: "+e)}}function m(){if(r.attributes===t){r.attributes=[]}}function y(e,t){m();r.attributes.push({name:e,key:t})}function _(e,t){m();r.attributes.push({name:e,template:t})}function A(e,n){if(r.properties===t){r.properties=[]}r.properties.push({name:e,key:n})}function w(e,n){if(r.events===t){r.events={}}if(r.events[e]===t){r.events[e]={keys:[]}}r.events[e].keys.push(n)}function $(e){var t=e.nodeName;if(t==="INPUT"||t==="TEXTAREA"||t==="SELECT"){return"change"}else if(t==="FORM"){return"submit"}else{return"click"}}return r};n.defaultEmptyScope={$:{_type:r,_scope:null,_manager:null,index:t,apply:function(e,n){if(typeof e==="function"){n=e;e=t}if(n!==t){n.call(this._scope,e)}this._manager.apply(e);return this._scope},applyLater:function(n,i){if(typeof n==="function"){i=n;n=t}if(i!==t){i.call(this._scope,n)}e.clearTimeout(this._scope.$._applyLaterTimeout);var r=this;this._scope.$._applyLaterTimeout=e.setTimeout(function(){r._scope.$.apply(n)},0);return this._scope},needsApply:function(){return this._manager.needsApply()},update:function(){this._manager.update();return this._scope},bind:function(e,t){this._manager.bind(e,t);return this._scope},merge:function(e){return p(this._scope,e)},replace:function(e){return this._manager.replaceScope(e)},clear:function(){for(var e in this._scope){if(e!=="$"){delete this._scope[e]}}},snapshot:function(e){var n=this._scope.$.snapshotLocal(e);if(this.parent()){n=p(this.parent().$.snapshot(e!==t?e:this._scope),n)}return n},snapshotLocal:function(e){var n=p(true,{},this._scope);for(var i in n){if(i.indexOf("$")===0){delete n[i]}else if(typeof n[i]==="function"){n[i]=n[i].call(e!==t?e:this._scope)}}return n},nodes:function(){return this._manager._domNodes},roots:function(){return this._manager._rootDomNodes},parent:function(){return this._manager._parentScope},watch:function(e,t){this._manager.watch(e,t);return this._scope},unwatch:function(e,t){this._manager.unwatch(e,t);return this._scope},get:function(e){var n=this.getLocal(e);if(n!==t){return n}else if(this.parent()){return this.parent().$.get(e)}else{return t}},getLocal:function(e,t){var n=l(this._scope,e);if(t&&typeof n==="function"){n=n.call(this._scope)}return n},set:function(e,n){var i=e.split(".");var r=this._scope;for(var o=0;o<i.length-1;o++){var s=r[i[o]];if(s===t){r=r[i[o]]={}}else{r=s}}r[i[i.length-1]]=n;return this._scope},getEventHandler:function(e){var n=this.getLocalEventHandler(e);if(n!==t){return n}else if(this.parent()){return this.parent().$.getEventHandler(e)}else{return t}},getLocalEventHandler:function(e){e=h(e);return this.getLocal(e,false)},setEventHandler:function(e,t){e=h(e);return this.set(e,t)},options:function(e){return this._manager.getOptions(e)}}};function h(e){var t=e.split(".");var n="";for(var i=0;i<t.length-1;i++){n+=t[i]+"."}var r=t[t.length-1];if(r.indexOf("$")!==0){n+="$"+r}else{n+=r}return n}function d(e,n,i,r,o,s){if(i===t){i=""}if(r===t){r=0}if(o===t){o=[]}if(s===t){s=[]}if(s.indexOf(e)!==-1||s.indexOf(n)!==-1){return o}s.push(e);s.push(n);var a;for(a in e){if(e[a]!==n[a]){if(typeof e[a]==="object"&&typeof n[a]==="object"){d(e[a],n[a],i+a+".",r+1,o,s)}else{o.push(i+a)}}}for(a in n){if(e[a]===t){o.push(i+a)}}return o}function v(e){var t=f({},e);t.$._scope=t;return t}_.prototype=new Object;var g=0;var m=0;var y="$all";function _(e,t){this._id="ConsistentScope"+g;g++;this._parentScope=e;this._options=t;this._nodes=[];this._domNodes=[];this._rootDomNodes=[];this._watchers={};this._nodesDirty=false;this._applying=false;this._scope=f({},n.defaultEmptyScope);this._scope.$._manager=this;this._scope.$._scope=this._scope;this._cleanScopeSnapshot=this._scope.$.snapshot()}_.prototype.apply=function(e){if(this._applying){return}this._applying=true;if(this._updateCleanScopeAndFireWatchers()||this._nodesDirty){var n=this._nodes.length;for(var i=0;i<n;i++){var r=this._nodes[i];var o=e!==t?f({},r.options,e):r.options;o.$.apply(r.dom,this._cleanScopeSnapshot,o);if(o.repeat){this._handleRepeat(r,o,this._cleanScopeSnapshot)}}this._nodesDirty=false;if(this._parentScope){this._parentScope.$.apply(e)}var s=e!==t?f({},this._options,e):this._options;s.$.afterApply(this._scope,this._cleanScopeSnapshot)}this._applying=false};_.prototype._handleRepeat=function(e,i,r){var o=i.repeat;var s;var a=e.repeatData;if(a===t){a={version:0,items:[]};if(i.repeatContainerId){var p=document.getElementById(i.repeatContainerId);if(p!==null){a.domNodes=p.children}else{throw new b("Couldn't find element with id \""+i.repeatId+'" for repeat container.')}}else{a.domNodes=[e.dom.cloneNode(true)]}for(s=0;s<a.domNodes.length;s++){a.domNodes[s].removeAttribute(n.settings.repeatDataAttribute);a.domNodes[s].removeAttribute(n.settings.repeatContainerIdDataAttribute)}e.repeatData=a;var f=document.createComment("Consistent repeat "+o);e.dom.parentNode.insertBefore(f,e.dom);e.dom.parentNode.removeChild(e.dom);f[n.settings.scopeIdKey]=this._id;e.dom=f;a.insertBefore=document.createComment("/Consistent repeat "+o);e.dom.parentNode.insertBefore(a.insertBefore,f.nextSibling)}var u=this._scope.$.get(o);var c=l(r,o);if(c===t){return}if(typeof c!=="object"){throw new b('Repeat for key "'+o+'" is not an object in the scope, found '+typeof c)}a.version++;var h=a.version;var d=a.insertBefore;var v=null;var g;for(s=0;s<u.length;s++){var m=u[s];g=$(m);var y=false;if(g===t){var _=S();var A=n(this._scope,this._options);A.$.bind(_);A=A.$.replace(m);g={object:m,domNodes:_,scope:A,version:h};a.items.push(g);y=true}else{g.version=h}N(g.domNodes,d,d.parentNode);if(y){for(var w=0;w<g.domNodes.length;w++){i.$.added(g.domNodes[w])}}g.after=v;v=g.domNodes[g.domNodes.length-1];g.scope.$.index=s;g.scope.$.apply()}for(s=0;s<a.items.length;s++){g=a.items[s];if(g.version!==h){if(g.after){N(g.domNodes,g.after.nextSibling,d.parentNode)}D(g.domNodes);a.items.splice(s,1);g.scope.$.index=t;s--}}function $(e){for(var n=0;n<a.items.length;n++){if(a.items[n].object===e){return a.items[n]}}return t}function S(){var e=[];for(var t=0;t<a.domNodes.length;t++){e.push(a.domNodes[t].cloneNode(true))}return e}function D(e){for(var t=0;t<e.length;t++){i.$.remove(e[t])}}function N(e,t,n){for(var i=0;i<e.length;i++){n.insertBefore(e[i],t)}}};_.prototype.update=function(){var e=this._nodes.length;for(var t=0;t<e;t++){var n=this._nodes[t];n.options.$.update(n.dom,this._scope,n.options)}};_.prototype.needsApply=function(){if(this._nodesDirty){return true}return this.isDirty()};_.prototype.isDirty=function(){return d(this._scope.$.snapshot(),this._cleanScopeSnapshot).length!==0};_.prototype._updateCleanScopeAndFireWatchers=function(){var e=false;var t;var i=true;var r=0;var o=this._cleanScopeSnapshot;var s={};while(i){var a=this._scope.$.snapshot();t=[];while(i){i=false;if(r>=n.settings.maxWatcherLoops){throw new b("Too many loops while notifying watchers. There is likely to be an infinite loop caused by watcher functions continously changing the scope. You may otherwise increase Consistent.settings.maxWatcherLoops if this is not the case.")}var p=d(a,o);for(var f=0;f<p.length;f++){var u=p[f];if(t.indexOf(u)===-1){t.push(u)}i|=this._notifyWatchers(u,l(a,u),l(o,u),this._scope,s)}r++}if(t.length>0){i|=this._notifyWatchAlls(t,this._scope,a,o,s);e=true}o=a}if(e){this._cleanScopeSnapshot=this._scope.$.snapshot();return true}else{return false}};_.prototype._notifyWatchers=function(e,i,r,o,s){var a=false;var p=this._watchers[e];if(p!==t){for(var f=0;f<p.length;f++){var u=s[e];if(u===t){s[e]=u={}}var l=p[f];var c=l[n.settings.functionIdKey];if(c===t){c=l[n.settings.functionIdKey]="ConsistentFunction"+m;m++}if(u[c]===t||u[c].cleanValue!==i){l.call(o,e,i,r);u[c]={cleanValue:o.$.get(e)};a=true}}}if(this._parentScope){this._parentScope.$._manager._notifyWatchers(e,i,r,o,s)}return a};_.prototype._notifyWatchAlls=function(e,i,r,o,s){var a=false;var p=this._watchers[y];if(p!==t){for(var f=0;f<p.length;f++){var u=s[y];if(u===t){s[y]=u={}}var l=p[f];var c=l[n.settings.functionIdKey];if(c===t){c=l[n.settings.functionIdKey]="ConsistentFunction"+m;m++}if(u[c]===t||d(r,u[c].cleanScopeSnapshot).length!==0){p[f].call(i,e,r,o);u[c]={cleanScopeSnapshot:i.$.snapshot()};a=true}}}if(this._parentScope){this._parentScope.$._manager._notifyWatchAlls(e,i,r,o,s)}return a};_.prototype.bind=function(e,i,r){if(a(e)){for(var o=0;o<e.length;o++){this.bind(e[o],i,r)}return}if(e[n.settings.scopeIdKey]!==this._id){var s=f({},this._options,i);s=s.$.getNodeOptions(e,s);this._nodes.push({dom:e,options:s});this._domNodes.push(e);if(r===t){this._rootDomNodes.push(e)}this._nodesDirty=true;e[n.settings.scopeIdKey]=this._id;var p=this;for(var u in s.events){!function(n,i){var r=function(r){for(var o=0;o<i.length;o++){var s=i[o];var a=p._scope.$.getEventHandler(s);if(a!==t){var f=a.call(e,r,p._scope);if(f===false)break}else{r.preventDefault();a=p._scope.$.get(s);if(typeof a==="function"){throw new b('Bound "'+n+'" event wanted scope function in key "'+h(s)+'", there was one in "'+s+'" which is missing the $ and is possibly a mistake.')}else{throw new b('Bound "'+n+'" event wanted scope function in key "'+h(s)+'"')}}}};s.events[n].listener=r;if(e.addEventListener){e.addEventListener(n,r,false)}else if(e.attachEvent){e.attachEvent("on"+n,r)}else{throw new b("Unable to attach event to DOM node. Cannot find supported method.")}}(u,s.events[u].keys)}var l=e.nodeName;if(s.autoListenToChange&&(l==="INPUT"||l==="TEXTAREA"||l==="SELECT")){var c=function(t){s.$.update(e,p._scope,s);p._scope.$.apply()};e.addEventListener("change",c,false);s.$._changeListener=c}}var d=e.firstChild;while(d!==null){if(d.nodeType===1){this.bind(d,i,e)}d=d.nextSibling}};_.prototype.unbind=function(e){var n;if(a(e)){for(n=0;n<e.length;n++){this.unbind(e[n])}return}n=this._domNodes.indexOf(e);if(n!==-1){var i=this._nodes[n];var r=i.options;for(var o in r.events){e.removeEventListener(o,r.events[o].listener,false)}if(r.$._changeListener!==t){e.removeEventListener("change",r.$._changeListener,false)}this._domNodes.slice(n,1);this._nodes.slice(n,1)}var s=e.firstChild;while(s!==null){if(s.nodeType===1){this.unbind(s)}s=s.nextSibling}};_.prototype.nodes=function(){return _domNodes};_.prototype.watch=function(e,n){if(typeof e==="function"&&n===t){n=e;e=y}var i=this._watchers[e];if(i===t){i=[];this._watchers[e]=i}i.push(n)};_.prototype.unwatch=function(e,n){if(typeof e==="function"&&n===t){n=e;e=y}var i=this._watchers[e];if(i!==t){var r=i.indexOf(n);i.splice(r,1)}};_.prototype.getOptions=function(e){for(var t=0;t<this._nodes.length;t++){if(this._nodes[t].dom===e){return this._nodes[t].options}}return null};_.prototype.replaceScope=function(e){e.$=this._scope.$;e.$._scope=e;this._scope=e;return e};b.prototype=new Error;function b(e){this._message=e}b.prototype.toString=function(){return"Consistent.js exception: "+this._message}}(window);if(!("indexOf"in Array.prototype)){Array.prototype.indexOf=function(e,t){if(t===undefined)t=0;if(t<0)t+=this.length;if(t<0)t=0;for(var n=this.length;t<n;t++){if(t in this&&this[t]===e){return t}}return-1}}/*! 
 * Consistent.js jQuery plugin 0.2.0
 * @author Karl von Randow
 * @license Apache License, Version 2.0
 */
!function(e,t,n){var i=e.consistent=t.Consistent;e.fn.consistent=function(){var e,t;if(arguments.length===0){this.each(function(){var t=i.findScopeForNode(this);if(t){if(e&&e!==t){throw"The given nodes have multiple different scopes"}e=t}else if(e){throw"Some of the given nodes have scopes and others don't"}});if(e){return e}else{e=i()}}else{var n=arguments[0];if(i.isScope(n)){e=n;t=arguments.length>1?arguments[1]:null}else if(typeof n==="object"){e=i(n);t=null}else{throw"First argument to $.consistent was not an appropriate type: "+typeof n}}this.each(function(){e.$.bind(this,t)});return e}}(jQuery,window);