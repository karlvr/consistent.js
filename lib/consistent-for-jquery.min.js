/*!
 * Consistent.js 0.9.1
 * @author Karl von Randow
 * @license Apache License, Version 2.0
 */
!function(e,t){var n=e.Consistent=function(){var e=arguments[0];if(e!==t){if(n.isScope(e)){if(arguments[1]!==t){return n.createScope(e,arguments[1])}else{return n.createScope(e,null)}}else if(e.nodeName!==t){return n.findScopeForNode(e)}else if(typeof e==="object"){return n.createScope(null,e)}else{throw T("Unexpected argument to Consistent(): "+e)}}else{return n.createScope(null,null)}};var i={};var r="ConsistentScope";var s=function(){var e={};var t=document.createElement("div");t.setAttribute("className","test");e.badGetSetAttribute=t.className==="test";e.needChangeEventForActiveOnSubmit=e.needAggressiveChangeHandlingOnInputElements=!!document.createEventObject;return e}();u(n,{settings:{attributes:{key:["data-ct","ct"],show:["data-ct-show","ct-show"],hide:["data-ct-hide","ct-hide"],enabled:["data-ct-enabled","ct-enabled"],disabled:["data-ct-disabled","ct-disabled"],readOnly:["data-ct-readonly","ct-readonly"],readWrite:["data-ct-readwrite","ct-readwrite"],options:["data-ct-options","ct-options"],template:["data-ct-tmpl","ct-tmpl"],templateId:["data-ct-tmpl-id","ct-tmpl-id"],attributes:["data-ct-attrs","ct-attrs"],attributePrefix:["data-ct-attr-","ct-attr-"],properties:["data-ct-props","ct-props"],propertyPrefix:["data-ct-prop-","ct-prop-"],templateAttributePrefix:["data-ct-tmpl-attr-","ct-tmpl-attr-"],templateIdAttributePrefix:["data-ct-tmpl-id-attr-","ct-tmpl-id-attr-"],classAttribute:["data-ct-class","ct-class"],classAddAttribute:["data-ct-add-class","ct-add-class"],on:["data-ct-on","ct-on"],onPrefix:["data-ct-on-","ct-on-"],repeat:["data-ct-repeat","ct-repeat"],repeatContainerId:["data-ct-repeat-container-id","ct-repeat-container-id"],noBind:["data-ct-nobind","ct-nobind"],warningPrefix:["data-ct-","ct-"]},scopeIdKey:"__ConsistentScopeID",functionIdKey:"__ConsistentFunctionID",oldDisplayKey:"__ConsistentOldDisplay",addedClassesKey:"__ConsistentAddedClasses",maxWatcherLoops:100},isScope:function(e){return e!==t&&e.$!==t&&e.$._type===r},createScope:function(e,t){t=c({},n.defaultOptions,t);var r=new E(e,t);i[r._id]=r;return r._scope},findScopeForNode:function(e){var t=e[n.settings.scopeIdKey];if(t&&i[t]){return i[t]._scope}else{return null}},expressionToFunction:function(e){throw T("Expression support requires consistent-expressions.js")},statementToFunction:function(e){throw T("Expression support requires consistent-expressions.js")},merge:u});var o={};function a(e){return o.toString.call(e)==="[object Array]"}function l(e){for(var t in e){return false}return true}function f(e,n,i){if(typeof e.indexOf==="function"){return e.indexOf(n,i)}else{if(i===t){i=0}if(i<0){i+=e.length;if(i<0){i=0}}for(var r=i;r<e.length;r++){if(e[r]===n){return r}}return-1}}function u(){var e=[];var n=[];function i(){var r=0;var s=false;if(typeof arguments[0]==="boolean"){s=arguments[0];r++}var o=arguments[r];if(typeof o!=="object"&&typeof o!=="function"){throw T("Target object argument to merge is not appropriate: "+typeof o)}if(o===null){throw T("Target object argument to merge is not appropriate: "+o)}for(var l=r+1;l<arguments.length;l++){var u=arguments[l];if(u===t){continue}if(typeof u!=="object"&&typeof u!=="function"){throw T("Argument "+(l+1)+" to merge is not appropriate: "+typeof u)}e.push(u);n.push(o);for(var c in u){if(c==="$"){continue}var p=u[c];if(p!==t){if(s&&typeof p==="object"&&p!==null){var d=f(e,p);if(d===-1){var h=o[c];if(h===t){h=a(p)?[]:{}}p=i(true,h,p)}else{p=n[d]}}o[c]=p}}}return o}return i.apply(this,arguments)}function c(){var e=[];for(var t=0;t<arguments.length;t++){var n=arguments[t];if(n){e.push(arguments[t].$)}}if(!e[0]){e[0]={}}var i=u.apply(this,arguments);i.$=u.apply(this,e);return i}function p(e){if(!s.badGetSetAttribute){return e}if(e==="class"){return"className"}else{return e}}function d(e,n){var i=n.split(".");var r=e;var s;for(s=0;s<i.length&&r!==t&&r!==null;s++){if(i[s]==="constructor"){throw T("Illegal attempt to access 'constructor' keyword for property: "+n)}if(r&&r.constructor===r){throw T("Illegal attempt to access Function constructor for property: "+n)}r=r[i[s]]}if(s===i.length){if(r&&r.constructor===r){throw T("Illegal attempt to access Function constructor for property: "+n)}return r}else{return t}}function h(e,n){if(n===t){n=""}var i=[];for(var r in e){if(typeof e[r]==="object"&&e[r]!==null){i=i.concat(h(e[r],n+r+"."))}else{i.push(n+r)}}return i}function v(e,n,i){var r=n.split(".");var s=e;for(var o=0;o<r.length-1;o++){if(s[r[o]]===t){s[r[o]]={}}s=s[r[o]]}s[r[r.length-1]]=i}function g(e){var t=e.value;if(!t){t=e.text}return t}function y(e,t){return e({get:function(e){return d(t,e)}})}function m(e,t){return e({get:function(e){return t.$.get(e)},set:function(e,n){return t.$.set(e,n)}})}n.defaultOptions={templateEngine:null,autoListenToChange:true,eventHandlerPrefix:"$",valueFunctionPrefix:"",$:{getNodeOptions:function(e,t){return n.getNodeOptions(e,t)},apply:function(e,n,i){var r,s,o;var l=i.bindings;if(l.selectOptions){s=d(n,l.selectOptions);if(s!==t){if(!s){s=[]}var f=e.selectedIndex!==-1?g(e.options[e.selectedIndex]):t;e.length=s.length;for(o=0;o<s.length;o++){var u;if(typeof s[o]==="object"){var c=s[o].text;var p=s[o].value;u=new Option(c!==t?c:"",p!==t?p:"",false,p==f);if(s[o].label!==t){u.label=s[o].label}if(s[o].disabled!==t){u.disabled=!!s[o].disabled}}else{u=new Option(s[o],s[o],false,s[o]==f)}e.options[o]=u}}}if(l.key){s=x(l.key);if(s!==t){this.setValue(e,s)}}else if(l.template!==t&&l.template!==null){this.setValue(e,l.template.render(n))}if(l.attributes){var v=l.attributes;for(o=0;o<v.length;o++){if(v[o].key!==t){s=x(v[o].key)}else if(v[o].template!==t){s=v[o].template.render(n)}else{s=null}if(s!==t){this.setAttributeValue(e,v[o].name,s)}}}if(l.allAttributes){s=d(n,l.allAttributes);for(r in s){if(s[r]!==t){s=s[r];if(r==="className"){r="class"}this.setAttributeValue(e,r,s)}}}if(l.classAttribute){s=x(l.classAttribute);if(s!==t){if(a(s)){s=s.join(" ")}this.setAttributeValue(e,"class",s)}}if(l.classAddAttribute){s=x(l.classAddAttribute);if(s!==t){this.addRemoveClasses(e,s)}}if(l.properties){var m=l.properties;for(o=0;o<m.length;o++){s=x(m[o].key);if(s!==t){this.setPropertyValue(e,m[o].name,s)}}}if(l.allProperties){s=d(n,l.allProperties);var b=h(s);for(o=0;o<b.length;o++){var _=d(s,b[o]);if(_!==t){this.setPropertyValue(e,b[o],_)}}}if(l.show){s=x(l.show);if(s!==t){if(s){this.show(e)}else{this.hide(e)}}}if(l.hide){s=x(l.hide);if(s!==t){if(!s){this.show(e)}else{this.hide(e)}}}if(l.enabled){s=x(l.enabled);if(s!==t){this.setPropertyValue(e,"disabled",!s)}}if(l.disabled){s=x(l.disabled);if(s!==t){this.setPropertyValue(e,"disabled",!!s)}}if(l.readOnly){s=x(l.readOnly);if(s!==t){this.setPropertyValue(e,"readOnly",!!s)}}if(l.readWrite){s=x(l.readWrite);if(s!==t){this.setPropertyValue(e,"readOnly",!s)}}function x(e){if(typeof e==="function"){return y(e,n)}else{return d(n,e)}}},afterApply:function(e,t){},setValue:function(e,t){var n=e.nodeName;if(n==="INPUT"||n==="TEXTAREA"){if(e.type==="checkbox"){if(a(t)){e.checked=e.defaultChecked=f(t,e.value)!==-1}else if(typeof t==="boolean"){e.checked=e.defaultChecked=t}else{e.checked=e.defaultChecked=t==e.value}}else if(e.type==="radio"){e.checked=e.defaultChecked=t==e.value}else{if(t===null){t=""}e.value=t}}else if(n==="SELECT"){if(t===null){t=""}var i;if(a(t)){for(i=0;i<e.options.length;i++){e.options[i].selected=f(t,g(e.options[i]))!==-1}}else{for(i=0;i<e.options.length;i++){if(g(e.options[i])==t){e.selectedIndex=i;return}}e.selectedIndex=-1}}else if(n==="IMG"){e.src=t}else{e.innerHTML=t}},setAttributeValue:function(e,t,n){t=p(t);if(n){e.setAttribute(t,n)}else{e.removeAttribute(t)}},setPropertyValue:function(e,t,n){v(e,t,n)},update:function(e,n,i){var r,s;var o=i.bindings;if(o.selectOptions){var l=e.options;r=[];for(s=0;s<l.length;s++){var u=l[s];r.push({text:u.text,value:u.value,label:u.label,disabled:u.disabled})}n.$.set(o.selectOptions,r)}if(o.key){r=this.getValue(e);if(r!==t){if(e.nodeName==="INPUT"&&e.type==="checkbox"){var c=n.$.get(o.key);if(a(c)){s=f(c,e.value);if(r){if(s===-1){c.push(e.value)}}else{if(s!==-1){c.splice(s,1)}}}else if(e.value!=="on"&&(c===t||c===null)){if(r){n.$.set(o.key,e.value)}}else if(typeof c==="boolean"||e.value==="on"){n.$.set(o.key,r)}else if(r&&c!==e.value){n.$.set(o.key,[c,e.value])}}else{n.$.set(o.key,r)}}}if(o.attributes){var p=o.attributes;for(s=0;s<p.length;s++){if(p[s].key!==t){r=this.getAttributeValue(e,p[s].name);n.$.set(p[s].key,r)}}}if(o.allAttributes){r=n.$.get(o.allAttributes);if(r!==t){for(s in r){r[s]=this.getAttributeValue(e,s)}n.$.set(o.allAttributes,r)}}if(o.classAttribute){r=this.getAttributeValue(e,"class");if(a(n.$.get(o.classAttribute))){r=r.split(" ")}n.$.set(o.classAttribute,r)}if(o.properties){var d=o.properties;for(s=0;s<d.length;s++){r=this.getPropertyValue(e,d[s].name);n.$.set(d[s].key,r)}}if(o.allProperties){r=n.$.get(o.allProperties);if(r!==t){var g=h(r);for(s=0;s<g.length;s++){v(r,g[s],this.getPropertyValue(e,g[s]))}n.$.set(o.allProperties,r)}}if(o.show){r=this.isShowing(e);n.$.set(o.show,r)}if(o.hide){r=this.isShowing(e);n.$.set(o.hide,!r)}if(o.enabled){r=this.getPropertyValue(e,"disabled");n.$.set(o.enabled,!r)}if(o.disabled){r=this.getPropertyValue(e,"disabled");n.$.set(o.disabled,r)}if(o.readOnly){r=this.getPropertyValue(e,"readOnly");n.$.set(o.readOnly,r)}if(o.readWrite){r=this.getPropertyValue(e,"readOnly");n.$.set(o.readWrite,!r)}},getValue:function(e){var n=e.nodeName;if(n==="INPUT"||n==="TEXTAREA"){if(e.type==="checkbox"){return e.checked}else if(e.type==="radio"){return e.checked?e.value:t}else{return e.value}}else if(n==="SELECT"){if(e.multiple){var i=[];for(var r=0;r<e.options.length;r++){if(e.options[r].selected){i.push(g(e.options[r]))}}return i}else if(e.selectedIndex!==-1){return g(e.options[e.selectedIndex])}else{return t}}else if(n==="IMG"){return e.src}else{return e.innerHTML}},getAttributeValue:function(e,t){t=p(t);return e.getAttribute(t)},getPropertyValue:function(e,t){return d(e,t)},addRemoveClasses:function(e,t){var i=p(t);var r=p(this.getAttributeValue(e,"class"));var s=e[n.settings.addedClassesKey];if(!s){s=[];e[n.settings.addedClassesKey]=s}var o,l,u;for(o=0;o<s.length;o++){l=f(i,s[o]);if(l===-1){u=f(r,s[o]);if(u!==-1){r.splice(u,1)}s.splice(o,1);o--}}for(o=0;o<i.length;o++){var c=i[o];l=f(s,c);if(l===-1){u=f(r,c);if(u===-1){r.push(c);s.push(c)}}}this.setAttributeValue(e,"class",r.join(" "));function p(e){if(e===null||!e){return[]}else if(typeof e==="string"){return e.split(" ")}else if(a(e)){return e}else{throw T("Unsupported value for add class: "+typeof e)}}},show:function(e){if(e.style.display!=="none"){return}var i=e[n.settings.oldDisplayKey];if(i===t){i=""}e.style.display=i},hide:function(e){if(e.style.display==="none"){return}e[n.settings.oldDisplayKey]=e.style.display;e.style.display="none"},isShowing:function(e){return e.style.display!=="none"},added:function(e){},remove:function(e){e.parentNode.removeChild(e)}}};n.getNodeOptions=n.defaultGetNodeOptions=function(e,i){var r=c({bindings:{}},i);var s=r.bindings;var o=e.nodeName;if(o==="INPUT"||o==="TEXTAREA"||o==="SELECT"){if(s.key===t){s.key=e.getAttribute("name")}}var l=n.settings;var f=e.attributes;for(var u=0;u<f.length;u++){var p=f[u].name;var d=v(p);if(d){var h=$(f[u].value);if(!h&&d.name!=="noBind"){continue}switch(d.name){case"key":{s.key=S(h);break}case"attributePrefix":{b(d.suffix,S(h));break}case"attributes":{s.allAttributes=h;break}case"template":{g();s.template=i.templateEngine.compile(h);break}case"templateId":{g();s.template=i.templateEngine.compile(y(h));break}case"templateAttributePrefix":{g();_(d.suffix,i.templateEngine.compile(h));break}case"templateIdAttributePrefix":{g();_(d.suffix,i.templateEngine.compile(y(h)));break}case"propertyPrefix":{x(d.suffix.replace(/-/g,"."),S(h));break}case"properties":{s.allProperties=h;break}case"on":{w(A(e),C(h));break}case"onPrefix":{w(d.suffix.toLowerCase(),C(h));break}case"show":{s.show=S(h);break}case"hide":{s.hide=S(h);break}case"repeat":{s.repeat=h;break}case"repeatContainerId":{s.repeatContainerId=h;break}case"enabled":{s.enabled=S(h);break}case"disabled":{s.disabled=S(h);break}case"readOnly":{s.readOnly=S(h);break}case"readWrite":{s.readWrite=S(h);break}case"options":{s.selectOptions=h;break}case"classAttribute":{s.classAttribute=S(h);break}case"classAddAttribute":{s.classAddAttribute=S(h);break}case"noBind":{s.noBind=!h||h==="true";break}case"warningPrefix":{if(typeof console!=="undefined"&&console.log!==t){console.log('Warning: Unrecognised Consistent attribute "'+p+'" on '+e.nodeName+" element.")}break}default:{throw T("Unhandled consistent declaration attribute: "+p)}}}}function v(e){for(var t in l.attributes){var n=l.attributes[t];var i;if(t.lastIndexOf("Prefix")===t.length-"Prefix".length){if(a(n)){for(i=0;i<n.length;i++){if(e.indexOf(n[i])===0){return{name:t,suffix:e.substring(n[i].length)}}}}else if(e.indexOf(n)===0){return{name:t,suffix:e.substring(n.length)}}}else{if(a(n)){for(i=0;i<n.length;i++){if(e===n[i]){return{name:t}}}}else if(e===n){return{name:t}}}}return false}function g(){if(!i.templateEngine){throw T("templateEngine not configured in options")}}function y(e){var t=document.getElementById(e);if(t!==null){return t.innerHTML}else{throw T("Template not found with id: "+e)}}function m(){if(s.attributes===t){s.attributes=[]}}function b(e,t){m();s.attributes.push({name:e,key:t})}function _(e,t){m();s.attributes.push({name:e,template:t})}function x(e,n){if(s.properties===t){s.properties=[]}s.properties.push({name:e,key:n})}function w(e,n){if(s.events===t){s.events={}}if(s.events[e]===t){s.events[e]={keys:[]}}s.events[e].keys.push(n)}function A(e){var t=e.nodeName;if(t==="INPUT"||t==="TEXTAREA"||t==="SELECT"){return"change"}else if(t==="FORM"){return"submit"}else{return"click"}}function $(e){return e.replace(/^\s*(.*)\s*$/,"$1")}function k(e){return e.match(/^[a-zA-Z_$][a-zA-Z_$0-9\.]*$/)}function S(e){if(k(e)){return e}else{return n.expressionToFunction(e)}}function C(e){if(k(e)){return e}else{return n.statementToFunction(e)}}return r};function b(e,n,i,r,s){if(s===t){s=[]}if(f(s,e)!==-1){return}s.push(e);var o=r.$.options();var a=o.eventHandlerPrefix;var l=o.valueFunctionPrefix;var u;var c=[];for(var p in e){if(f(c,p)!==-1){continue}if(p.indexOf(a)===0){if(n){u=x(p,a);if(u===p||e[u]===t){e[u]=e[p]}if(u!==p){delete e[p];c.push(u)}}else{delete e[p]}}else if(typeof e[p]==="function"){if(!l){e[p]=e[p].call(i)}else if(p.indexOf(l)===0){u=x(p,l);e[u]=e[p].call(i);delete e[p];if(u!==p){c.push(u)}}}else if(typeof e[p]==="object"&&e[p]!==null){b(e[p],n,i,r,s)}}}n.defaultEmptyScope={$:{_type:r,_scope:null,_manager:null,index:t,apply:function(e,n){if(typeof e==="function"){n=e;e=t}var i=this._scope();if(n!==t){n.call(i,e)}this._manager().apply(e);return i},applyLater:function(n,i){if(typeof n==="function"){i=n;n=t}var r=this._scope();if(i!==t){i.call(r,n)}e.clearTimeout(this._applyLaterTimeout);this._applyLaterTimeout=e.setTimeout(function(){r.$.apply(n)},0);return r},needsApply:function(){return this._manager().needsApply()},update:function(){this._manager().update();return this._scope()},bind:function(e,t){this._manager().bind(e,t);return this._scope()},unbind:function(e){this._manager().unbind(e);return this._scope()},merge:function(e,n){var i=this._scope();if(typeof e==="boolean"){return u(e,i,n)}else if(n===t){return u(i,e)}else if(a(n)){for(var r=0;r<n.length;r++){v(i,n[r],d(e,n[r]))}return i}else if(typeof n!=="object"){v(i,n,d(e,n));return i}else{throw T("Invalid keys argument to merge: "+n)}},replace:function(e){return this._manager().replaceScope(e)},clear:function(){var e=this._scope();for(var t in e){if(t!=="$"){delete e[t]}}},model:function(e,n){if(e!==t&&typeof e!=="boolean"){throw T("Invalid type for includeParents: "+typeof e)}var i=this._scope();var r=u(true,{},i);b(r,false,n!==t?n:i,i);if(e!==false&&this.parent()){r=u(this.parent().$.model(e,n!==t?n:i),r)}return r},snapshot:function(e,n){if(e!==t&&typeof e!=="boolean"){throw T("Invalid type for includeParents: "+typeof e)}var i=this._scope();var r=u(true,{},i);b(r,true,n!==t?n:i,i);if(e!==false&&this.parent()){r=u(this.parent().$.snapshot(e,n!==t?n:i),r)}return r},nodes:function(e){if(e!==t&&typeof e!=="boolean"){throw T("Invalid type for includeParents: "+typeof e)}var n=this._manager()._domNodes;if(e!==false){var i=this.children();for(var r=0;r<i.length;r++){n=n.concat(i[r].$.nodes())}}return n},roots:function(){return this._manager()._rootDomNodes},parent:function(){var e=this._manager()._parentScopeManager;if(e!==null){return e._scope}else{return null}},children:function(){var e=[];var t=this._manager()._childScopeManagers;for(var n=0;n<t.length;n++){e.push(t[n]._scope)}return e},watch:function(e,t){this._manager().watch(e,t);return this._scope()},unwatch:function(e,t){this._manager().unwatch(e,t);return this._scope()},get:function(e,n){if(n!==t&&typeof n!=="boolean"){throw T("Invalid type for includeParents: "+typeof n)}if(e==="$"||e.substring(0,2)==="$."){return t}var i=this.options().valueFunctionPrefix;var r=this._scope();var s=d(r,e);if(s!==t){if(!i&&typeof s==="function"){return s.call(r)}else{return s}}else{var o;if(i){o=_(e,i);s=d(r,o);if(typeof s==="function"){return s.call(r)}}o=_(e,this.options().eventHandlerPrefix);s=d(r,o);if(typeof s==="function"){return s}}if(n!==false&&this.parent()){return this.parent().$.get(e)}else{return t}},set:function(e,n){var i=this._scope();var r=d(i,e);if(typeof r==="undefined"){var s=this.getValueFunction(e);if(s!==t){s.call(i,n);return i}}if(typeof r!=="function"){v(i,e,n)}else if(!this.options().valueFunctionPrefix){r.call(i,n)}else{v(i,e,n)}return i},getEventHandler:function(e,n){if(n!==t&&typeof n!=="boolean"){throw T("Invalid type for includeParents: "+typeof n)}var i=this._scope();var r=this.options().eventHandlerPrefix;var s=d(i,_(e,r));if(s!==t){return s}else if(n!==false&&this.parent()){return this.parent().$.getEventHandler(e)}else{return t}},setEventHandler:function(e,t){e=_(e,this.options().eventHandlerPrefix);var n=this._scope();v(n,e,t);return n},getValueFunction:function(e,n){if(n!==t&&typeof n!=="boolean"){throw T("Invalid type for includeParents: "+typeof n)}var i=this._scope();var r=this.options().valueFunctionPrefix;if(r&&d(i,e)!==t){return t}var s=d(i,_(e,r));if(s!==t){return s}else if(n!==false&&this.parent()){return this.parent().$.getValueFunction(e)}else{return t}},setValueFunction:function(e,t){e=_(e,this.options().valueFunctionPrefix);var n=this._scope();v(n,e,t);return n},options:function(e){return this._manager().getOptions(e)},evaluate:function(e){var t=n.expressionToFunction(e);var i=this.snapshot();return y(t,i)},exec:function(e){var t=n.statementToFunction(e);return m(t,this._scope())}}};function _(e,t){if(!t){return e}var n=e.split(".");var i="";for(var r=0;r<n.length-1;r++){i+=n[r]+"."}var s=n[n.length-1];if(w(t)){i+=t+s.substring(0,1).toUpperCase()+s.substring(1)}else{i+=t+s}return i}function x(e,n){if(n===t){return e}if(w(n)){var i=e.substring(n.length);return i.substring(0,1).toLowerCase()+i.substring(1)}else{return e.substring(n.length)}}function w(e){if(!e){return false}var t=e.charAt(e.length-1);return t>="A"&&t<="Z"||t>="a"&&t<="z"}function A(e,n,i,r,s,o){if(i===t){i=""}if(r===t){r=0}if(s===t){s=[]}if(o===t){o=[]}if(f(o,e)!==-1||f(o,n)!==-1){return s}o.push(e);o.push(n);if(e===n){return s}var a;if(n!==null){for(a in e){if(e[a]!==n[a]){if(typeof e[a]==="object"&&typeof n[a]==="object"&&e[a]&&n[a]){A(e[a],n[a],i+a+".",r+1,s,o)}else{s.push(i+a)}}}}else{for(a in e){s.push(i+a)}}for(a in n){if(e===null||e[a]===t){s.push(i+a)}}return s}function $(e,t){var n=typeof e;if(n!==typeof t){return false}if(n==="function"){return e===t}else if(n==="object"){var i=A(e,t);return i.length===0}else{return true}}function k(e,t){for(var n=0;n<t.length;n++){e.removeAttribute(t[n])}}E.prototype=new Object;var S=0;var C=0;var N="$all";function E(e,t){this._id="ConsistentScope"+S;S++;if(e){this._parentScopeManager=e.$._manager();this._parentScopeManager._childScopeManagers.push(this)}else{this._parentScopeManager=null}this._childScopeManagers=[];this._options=t;this._nodes=[];this._domNodes=[];this._repeatNodes=[];this._rootDomNodes=[];this._watchers={};this._nodesDirty=false;this._applying=false;var i=this;this._scope=c({},n.defaultEmptyScope);this._scope.$._manager=function(){return i};this._scope.$._scope=function(){return i._scope};this._cleanScopeSnapshot=this._scope.$.snapshot()}E.prototype.apply=function(e){if(this._applying){return}this._applying=true;if(this._updateCleanScopeAndFireWatchers()||this._nodesDirty){var n=this._nodes.length;var i,r;for(i=0;i<n;i++){var s=this._nodes[i];r=e!==t?c({},s.options,e):s.options;r.$.apply(s.dom,this._cleanScopeSnapshot,r)}n=this._repeatNodes.length;for(i=0;i<n;i++){var o=this._repeatNodes[i];r=e!==t?c({},o.options,e):o.options;this._handleRepeat(o,r,this._cleanScopeSnapshot)}this._nodesDirty=false;if(this._parentScopeManager){this._parentScopeManager._scope.$.apply(e)}var a=e!==t?c({},this._options,e):this._options;a.$.afterApply(this._scope,this._cleanScopeSnapshot)}this._applying=false};E.prototype._handleRepeat=function(e,i,r){var s=i.bindings.repeat;var o;var a=this._scope.$.get(s);var l=d(r,s);if(l===t){return}if(typeof l!=="object"){throw T('Repeat for key "'+s+'" is not an object in the scope, found '+typeof l)}e.version++;var f=e.version;var u=e.insertBefore;var c=null;var p;for(o=0;o<a.length;o++){var h=a[o];p=b(h);var v=false;if(p===t){var g=_();var y=n(this._scope,this._options);y.$.bind(g);y=y.$.replace(h);p={object:h,domNodes:g,scope:y,version:f};e.items.push(p);v=true}else{p.version=f}w(p.domNodes,u,u.parentNode);if(v){for(var m=0;m<p.domNodes.length;m++){i.$.added(p.domNodes[m])}}p.after=c;c=p.domNodes[p.domNodes.length-1];p.scope.$.index=o;p.scope.$.apply()}for(o=0;o<e.items.length;o++){p=e.items[o];if(p.version!==f){if(p.after){w(p.domNodes,p.after.nextSibling,u.parentNode)}x(p.domNodes,p.scope);e.items.splice(o,1);p.scope.$.index=t;o--}}function b(n){for(var i=0;i<e.items.length;i++){if(e.items[i].object===n){return e.items[i]}}return t}function _(){var t=[];for(var n=0;n<e.domNodes.length;n++){t.push(e.domNodes[n].cloneNode(true))}return t}function x(e,t){for(var n=0;n<e.length;n++){t.$.unbind(e[n]);i.$.remove(e[n])}}function w(e,t,n){for(var i=0;i<e.length;i++){n.insertBefore(e[i],t)}}};E.prototype.update=function(){var e=this._nodes.length;for(var t=0;t<e;t++){var n=this._nodes[t];n.options.$.update(n.dom,this._scope,n.options)}};E.prototype.needsApply=function(){if(this._nodesDirty){return true}return this.isDirty()};E.prototype.isDirty=function(){return A(this._scope.$.snapshot(),this._cleanScopeSnapshot).length!==0};E.prototype._updateCleanScopeAndFireWatchers=function(){var e=false;var t;var i=true;var r=0;var s=this._cleanScopeSnapshot;var o={};while(i){var a=this._scope.$.snapshot();t=[];while(i){i=false;if(r>=n.settings.maxWatcherLoops){throw T("Too many loops while notifying watchers. There is likely to be an infinite loop caused by watcher functions continously changing the scope. You may otherwise increase Consistent.settings.maxWatcherLoops if this is not the case.")}var l=A(a,s);for(var u=0;u<l.length;u++){var c=l[u];if(f(t,c)===-1){t.push(c)}i|=this._notifyWatchers(c,d(a,c),d(s,c),this._scope,o)}r++}if(t.length>0){i|=this._notifyWatchAlls(t,this._scope,a,s,o);e=true}s=a}if(e){this._cleanScopeSnapshot=this._scope.$.snapshot();return true}else{return false}};E.prototype._notifyWatchers=function(e,i,r,s,o){var a=false;var l=this._watchers[e];if(l!==t){for(var f=0;f<l.length;f++){var u=o[e];if(u===t){o[e]=u={}}var c=l[f];var p=c[n.settings.functionIdKey];if(p===t){p=c[n.settings.functionIdKey]="ConsistentFunction"+C;C++}if(u[p]===t||!$(u[p].cleanValue,i)){c.call(s,e,i,r);u[p]={cleanValue:s.$.get(e)};a=true}}}if(this._parentScopeManager){this._parentScopeManager._notifyWatchers(e,i,r,s,o)}return a};E.prototype._notifyWatchAlls=function(e,i,r,s,o){var a=false;var l=this._watchers[N];if(l!==t){for(var f=0;f<l.length;f++){var u=o[N];if(u===t){o[N]=u={}}var c=l[f];var p=c[n.settings.functionIdKey];if(p===t){p=c[n.settings.functionIdKey]="ConsistentFunction"+C;C++}if(u[p]===t||!$(r,u[p].cleanScopeSnapshot)){l[f].call(i,e,r,s);u[p]={cleanScopeSnapshot:i.$.snapshot()};a=true}}}if(this._parentScopeManager){this._parentScopeManager._notifyWatchAlls(e,i,r,s,o)}return a};function P(e,t,n){if(e.addEventListener){e.addEventListener(t,n,false)}else if(e.attachEvent){e.attachEvent("on"+t,n)}else{throw T("Unable to attach event to DOM node. Cannot find supported method.")}}function I(e){if(!e.preventDefault){e.preventDefault=function(){this.returnValue=false}}}function O(e,t){var n;if(document.createEvent){n=document.createEvent("HTMLEvents");n.initEvent(t,true,true);e.dispatchEvent(n)}else if(document.createEventObject){e.fireEvent("on"+t)}else{throw T("Unable to fire a DOM event. Cannot find supported method.")}return n}E.prototype.bind=function(e,i,r){var o;if(a(e)){for(o=0;o<e.length;o++){this.bind(e[o],i,r)}return}var f;if(e[n.settings.scopeIdKey]!==this._id){f=c({},this._options,i);f=f.$.getNodeOptions(e,f);if(f.bindings.noBind){return}e[n.settings.scopeIdKey]=this._id;if(r===t){this._rootDomNodes.push(e)}if(!l(f.bindings)){if(f.bindings.repeat!==t){var u={version:0,items:[],options:f};var p=f.bindings.repeat;if(f.bindings.repeatContainerId){var d=document.getElementById(f.bindings.repeatContainerId);if(d!==null){u.domNodes=d.children}else{throw T("Couldn't find element with id \""+f.bindings.repeatContainerId+'" for repeat container.')}}else{u.domNodes=[e.cloneNode(true)]}for(o=0;o<u.domNodes.length;o++){k(u.domNodes[o],n.settings.attributes.repeat);k(u.domNodes[o],n.settings.attributes.repeatContainerId)}var h=document.createComment("Consistent repeat "+p);e.parentNode.insertBefore(h,e);e.parentNode.removeChild(e);h[n.settings.scopeIdKey]=this._id;u.insertBefore=document.createComment("/Consistent repeat "+p);h.parentNode.insertBefore(u.insertBefore,h.nextSibling);this._repeatNodes.push(u);this._nodesDirty=true}else{this._nodes.push({dom:e,options:f});this._domNodes.push(e);this._nodesDirty=true;var v=this;for(var g in f.bindings.events){!function(n,i){var r=function(r){var o;I(r);if(s.needChangeEventForActiveOnSubmit&&n==="submit"&&e.nodeName==="FORM"){for(o=0;o<e.elements.length;o++){if(document.activeElement===e.elements[o]){O(e.elements[o],"change")}}}for(o=0;o<i.length;o++){var a=i[o];var l;var f;if(typeof a==="function"){f=m(a,v._scope);if(typeof f!=="function"){v._scope.$.apply();continue}else{l=f}}if(l===t){l=v._scope.$.getEventHandler(a)}if(l!==t){if(l){f=l.call(v._scope,r,e);if(f===false)break}}else{r.preventDefault();var u=v._options.eventHandlerPrefix;throw T('Bound "'+n+'" event cannot find an event handler function in "'+_(a,u)+'"')}}};f.bindings.events[n].listener=r;P(e,n,r)}(g,f.bindings.events[g].keys)}var y=e.nodeName;if(f.autoListenToChange&&(y==="INPUT"||y==="TEXTAREA"||y==="SELECT")){var b=function(t){I(t);f.$.update(e,v._scope,f);v._scope.$.apply()};P(e,"change",b,false);if(s.needAggressiveChangeHandlingOnInputElements&&y==="INPUT"&&(e.type==="checkbox"||e.type==="radio")){P(e,"click",b,false)}f.$._changeListener=b}}}}if(f===t||!f.bindings.repeat){var x=e.firstChild;while(x!==null){if(x.nodeType===1){this.bind(x,i,e)}x=x.nextSibling}}};E.prototype.unbind=function(e){var n;if(a(e)){for(n=0;n<e.length;n++){this.unbind(e[n])}return}n=f(this._domNodes,e);if(n!==-1){var i=this._nodes[n];var r=i.options;for(var s in r.bindings.events){e.removeEventListener(s,r.bindings.events[s].listener,false)}if(r.$._changeListener!==t){e.removeEventListener("change",r.$._changeListener,false)}this._domNodes.splice(n,1);this._nodes.splice(n,1)}var o=e.firstChild;while(o!==null){if(o.nodeType===1){this.unbind(o)}o=o.nextSibling}};E.prototype.watch=function(e,n){if(typeof e==="function"&&n===t){n=e;e=N}var i=this._watchers[e];if(i===t){i=[];this._watchers[e]=i}i.push(n)};E.prototype.unwatch=function(e,n){if(typeof e==="function"&&n===t){n=e;e=N}var i=this._watchers[e];if(i!==t){var r=f(i,n);i.splice(r,1)}};E.prototype.getOptions=function(e){if(e===t){return this._options}for(var n=0;n<this._nodes.length;n++){if(this._nodes[n].dom===e){return this._nodes[n].options}}return null};E.prototype.replaceScope=function(e){e.$=this._scope.$;this._scope=e;return e};function T(e){return new j(e)}j.prototype=new Object;function j(e){this.name="ConsistentException";this.message=e}j.prototype.toString=function(){return"Consistent.js exception: "+this.message}}(window);/*!
 * Consistent.js Expressions 0.9.1
 * @author Karl von Randow
 * @license Apache License, Version 2.0
 */
!function(e,t){if(typeof Consistent==="undefined"){throw"Consistent must be included before consistent-expressions.js"}Consistent.expressionToFunction=function(e){var t=f(e);var n=u(t,false,e);try{return new Function("ctx",n)}catch(i){throw"Error compiling expression: "+e+" => "+n+" ("+i+")"}};Consistent.statementToFunction=function(e){var t=f(e);var n=u(t,true,e);try{return new Function("ctx",n)}catch(i){throw"Error compiling statements: "+e+" => "+n+" ("+i+")"}};var n=0;var i=1;var r=2;var s=3;var o=4;var a=5;var l=6;function f(e){var t=[];var f=0;var u=e.length;var c=n;var m="";while(f<u){var b=e.charAt(f);if(c===n){if(p(b)){c=i}else if(h(b)){c=o}else if(g(b)){c=r}else if(y(b)){c=s}else if(w(b)){c=a}else if(x(b)){c=l}else if(v(b)){throw"Illegal escape character at "+f+": "+e}else if($(b)){f++;continue}else{throw"Invalid character '"+b+"' at "+f+": "+e}}else if(c===i){if(!d(b)){_();continue}}else if(c===r){if(!g(b)){_();continue}}else if(c===s){_();continue}else if(c===o){if(h(b)){m+=b;f++;_();continue}else if(v(b)){m+=b;f++;b=e.charAt(f)}}else if(c===a){if(!A(b)){_();continue}}else if(c===l){_();continue}m+=b;f++}function _(){if(m.length>0){if(c===i&&k(m)){var e=S(m);if(e!==null){t.push({type:r,text:e})}else{t.push({type:a,text:m})}}else{t.push({type:c,text:m})}}m="";c=n}_();return t}function u(e,t,n){var f=[];var p=[[]];var d=[[]];var h=0;var v,g=e.length;for(v=0;v<g;v++){var y=p[p.length-1];var m=d[d.length-1];var x=e[v];var w=x.type;if(w===i){if(t){var A=v+1<g?e[v+1]:null;if(A!==null&&A.type===r&&b(A.text)){y.push('ctx.set("'+c(x.text)+'", ');m.unshift(")");var $=_(A.text);if($){y.push('ctx.get("'+c(x.text)+'")');y.push($)}v++;continue}}y.push('ctx.get("'+c(x.text)+'")')}else if(w===r){if(b(x.text)){throw"Assignment is invalid in expression: "+n}else{y.push(x.text)}}else if(w===o||w===a){y.push(x.text)}else if(w===s){if(x.text==="("){p.push([]);d.push([])}else{if(!y.length||p.length<2){throw"Invalid bracketed expression in expression: "+n}f.push("var __group"+h+" = "+y.join(" ")+m.join(" ")+";");p.pop();d.pop();y=p[p.length-1];y.push("__group"+h);h++}}else if(w===l){if(t){y.push(d[0].join(" ")+";");d[0]=[];var k=u(e.slice(v+1),true,n);y.push(k);break}else{throw"Invalid multiple statements in expression: "+n}}}if(p.length!==1){throw"Unbalanced bracketed expressions in expression: "+n}return f.join(" ")+(v==g?" return ":"")+p[0].join(" ")+d[0].join(" ")+";"}function c(e){return e.replace(/"/g,'\\"')}function p(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_"||e==="$"}function d(e){return p(e)||e==="."||e>="0"&&e<="9"}function h(e){return e==="'"||e==='"'}function v(e){return e==="\\"}function g(e){return e==="!"||e==="%"||e==="="||e==="<"||e===">"||e==="*"||e==="/"||e==="+"||e==="-"||e==="^"||e==="&"||e==="?"||e===":"}function y(e){return e==="("||e===")"}function m(e){return e==="="||e==="+="||e==="-="||e==="*="||e==="/="||e==="%="}function b(e){return m(e)||e==="++"||e==="--"}function _(e){if(e==="="){return null}else if(e.length==2&&e.indexOf("=")===1){return e.charAt(0)}else if(e==="++"){return"+1"}else if(e==="--"){return"-1"}else{throw"Unsupported mutation operator: "+e}}function x(e){return e===";"}function w(e){return e>="0"&&e<="9"}function A(e){return w(e)||e=="."}function $(e){return e<=" "}function k(e){return e==="true"||e==="false"||e==="null"||e==="undefined"||e==="and"||e==="or"||e==="not"||e==="lt"||e==="le"||e==="gt"||e==="ge"||e==="eq"||e==="ne"}function S(e){if(e==="and"){return"&&"}else if(e==="or"){return"||"}else if(e==="not"){return"!"}else if(e==="lt"){return"<"}else if(e==="le"){return"<="}else if(e==="gt"){return">"}else if(e==="ge"){return">="}else if(e==="eq"){return"=="}else if(e==="ne"){return"!="}else{return null}}}(window);/*! 
 * Consistent.js jQuery plugin 0.9.1
 * @author Karl von Randow
 * @license Apache License, Version 2.0
 */
!function(e,t,n){var i=e.consistent=t.Consistent;e.fn.consistent=function(){var e,t;if(arguments.length===0){this.each(function(){var t=i.findScopeForNode(this);if(t){if(e&&e!==t){throw"The given nodes have multiple different scopes"}e=t}else if(e){throw"Some of the given nodes have scopes and others don't"}});if(e){return e}else{e=i()}}else{var n=arguments[0];if(i.isScope(n)){e=n;t=arguments.length>1?arguments[1]:null}else if(typeof n==="object"){e=i(n);t=null}else{throw"First argument to $.consistent was not an appropriate type: "+typeof n}}this.each(function(){e.$.bind(this,t)});return e}}(jQuery,window);